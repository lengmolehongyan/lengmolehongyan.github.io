<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[å†·æ¼ å»è­é¢œ]]></title>
  <link href="http://lengmolehongyan.github.io/atom.xml" rel="self"/>
  <link href="http://lengmolehongyan.github.io/"/>
  <updated>2015-12-26T11:47:55+08:00</updated>
  <id>http://lengmolehongyan.github.io/</id>
  <author>
    <name><![CDATA[lengmolehongyan]]></name>
    <email><![CDATA[lengmohongyan@hotmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[iOS è‡ªå®šä¹‰é€šçŸ¥å£°éŸ³]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/12/25/zi-ding-yi-tong-zhi-sheng-yin/"/>
    <updated>2015-12-25T22:49:49+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/12/25/zi-ding-yi-tong-zhi-sheng-yin</id>
    <content type="html"><![CDATA[<p>é¡¹ç›®ä¸­é‡åˆ°éœ€è¦è‡ªå®šä¹‰é€šçŸ¥å£°éŸ³çš„éœ€æ±‚ï¼Œä»¥å‰æ²¡åšè¿‡ï¼Œå°±æŸ¥äº†ä¸‹<a href="https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Chapters/IPhoneOSClientImp.html#//apple_ref/doc/uid/TP40008194-CH103-SW6">å®˜æ–¹æ–‡æ¡£</a>ï¼Œå°±åƒæ–‡æ¡£ä¸Šè¯´çš„ï¼Œå®ç°èµ·æ¥ç¡®å®æŒºç®€å•ï¼Œå°±æ•´ç†ä¸‹å½“åšå¤‡å¿˜å§ã€‚</p>

<p>å…³äºæ¨é€ï¼Œå®˜æ–¹æ–‡æ¡£ã€å„ç§ç¬¬ä¸‰æ–¹æ¨é€æ–‡æ¡£éƒ½å¾ˆå…¨ï¼Œå°±è·³è¿‡äº†ã€‚</p>

<p>ç”±äºè‡ªå®šä¹‰é€šçŸ¥å£°éŸ³è¿˜æ˜¯ç”± iOS ç³»ç»Ÿæ¥æ’­æ”¾çš„ï¼Œæ‰€ä»¥å¯¹éŸ³é¢‘æ•°æ®æ ¼å¼æœ‰é™åˆ¶ï¼Œå¯ä»¥æ˜¯å¦‚ä¸‹å››ç§ä¹‹ä¸€ï¼š</p>

<ol>
<li>Linear PCM</li>
<li>MA4 (IMA/ADPCM)</li>
<li>ÂµLaw</li>
<li>aLaw</li>
</ol>


<p></p>


<p>å¯¹åº”éŸ³é¢‘æ–‡ä»¶æ ¼å¼æ˜¯ <code>aiff</code>ï¼Œ<code>wav</code>ï¼Œ<code>caf</code> æ–‡ä»¶ï¼Œæ–‡ä»¶ä¹Ÿå¿…é¡»æ”¾åˆ° app çš„ <code>mainBundle</code> ç›®å½•ä¸­ã€‚</p>

<p>è‡ªå®šä¹‰é€šçŸ¥å£°éŸ³çš„æ’­æ”¾æ—¶é—´å¿…é¡»åœ¨ 30s å†…ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶ï¼Œåˆ™å°†ç”¨ç³»ç»Ÿé»˜è®¤é€šçŸ¥å£°éŸ³æ›¿ä»£ã€‚</p>

<!--more-->


<p>å¯ä»¥ä½¿ç”¨ <code>afconvert</code> å·¥å…·æ¥å¤„ç†éŸ³é¢‘æ–‡ä»¶æ ¼å¼ï¼Œåœ¨ç»ˆç«¯ä¸­æ•²å…¥å¦‚ä¸‹å‘½ä»¤å°±å¯ä»¥å°†ä¸€ä¸ª <code>mp3</code> æ–‡ä»¶è½¬æ¢æˆ <code>caf</code> æ–‡ä»¶ï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>afconvert unbelievable.mp3 unbelievable.caf -d ima4 -f caff -v</span></code></pre></td></tr></table></div></figure>


<p>è½¬æ¢å®Œæˆåå°±å¯ä»¥å°† <code>unbelievable.caf</code> è¿™ä¸ªæ–‡ä»¶æ‹–å…¥ Xcode å·¥ç¨‹ä¸­ï¼Œç¼–è¯‘è¿è¡Œé¡¹ç›®åœ¨çœŸæœºä¸Šã€‚</p>

<p><img src="http://lengmolehongyan.github.io/images/QQ20151226-0@2x.png" alt="å°† unbelievable.caf æ–‡ä»¶æ‹–å…¥å·¥ç¨‹ä¸­" /></p>

<p>å‘é€æ¨é€é€šçŸ¥æ—¶ï¼Œåªéœ€é…ç½® <code>sound</code> å­—æ®µçš„å€¼ä¸ºå¯¼å…¥åˆ°å·¥ç¨‹ä¸­çš„éŸ³é¢‘æ–‡ä»¶åï¼Œè¿™é‡Œå³å°±æ˜¯ <code>unbelievable.caf</code>ã€‚</p>

<p>æµ‹è¯•~~ï¼Œå®Œç¾ï¼ï¼ï¼æ”¶åˆ°æ¨é€æ—¶ï¼Œé€šçŸ¥å£°éŸ³å°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å£°éŸ³äº†ã€‚</p>

<p><img src="http://lengmolehongyan.github.io/images/QQ20151226-1@2x.png" alt="æ”¶åˆ°æ¨é€ä¿¡æ¯" /></p>

<p><a href="https://github.com/lengmolehongyan/CustomAlertSoundsDemo">Demo åœ°å€</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Xcode é¡¹ç›®å¿½ç•¥è­¦å‘Š]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/12/09/hu-lue-jing-gao/"/>
    <updated>2015-12-09T23:26:54+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/12/09/hu-lue-jing-gao</id>
    <content type="html"><![CDATA[<p>å¯¹äºä¸€ä¸ªæœ‰å¼ºè¿«ç—‡çš„æˆ‘ï¼Œæ¯æ¬¡ <code>âŒ˜B</code> Build é¡¹ç›®æ—¶ï¼Œå‘ç°ä¸€ä¸ª <img src="http://lengmolehongyan.github.io/images/DVTStatus-Warning@2x.png" width="30"> è­¦å‘Šéƒ½è¦ç‚¹è¿›å»ä¿®å¤äº†ï¼Œç„¶è€Œï¼Œå¯¹äºä¸€äº›æ— å…³ç´§è¦çš„è­¦å‘Šï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥é€‰æ‹©å¿½ç•¥è¿™ä¸ªè­¦å‘Šï¼Œè®© Xcode ä¸æç¤ºå‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚</p>

<p>ä¸‹é¢ï¼Œå°±ä»‹ç»ä¸€ä¸‹åœ¨é¡¹ç›®ä¸­å¿½ç•¥è­¦å‘Šçš„ä¸‰ä¸ªåœ°æ–¹ï¼š</p>

<!--more-->


<h2>åœ¨æºæ–‡ä»¶ä¸­å¿½ç•¥è­¦å‘Š</h2>

<p>åœ¨ä¸€äº›ç¬¬ä¸‰æ–¹åº“ä¸­ï¼Œæ€»èƒ½çœ‹åˆ°ä¸‹é¢è¿™æ®µä»£ç çš„èº«å½±ï¼Œè¿™å°±æ˜¯ç”¨äºå¿½ç•¥æŸä¸ªè­¦å‘Š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#pragma clang diagnostic push</span>
</span><span class='line'><span class="cp">#pragma clang diagnostic ignored &quot;è­¦å‘Šæ ‡è¯†ç¬¦&quot;</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="cp">#pragma clang diagnostic pop</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç”¨æ³•å¾ˆç®€å•ï¼Œæ¯”å¦‚åœ¨æ§åˆ¶å™¨çš„ <code>-viewDidLoad</code> ä¸­å†™äº†å¥åˆ›å»ºä¸€ä¸ª <code>eTestView</code> çš„ä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">UIView</span> <span class="o">*</span><span class="n">eTestView</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>Xcode ä¼šç«‹å³æŠ¥ä¸€ä¸ªè­¦å‘Šï¼Œæç¤ºæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªå˜é‡</p>

<p><img src="http://lengmolehongyan.github.io/images/QQ20151213-0@2x.png" alt="Unused variable 'eTestView'" /></p>

<p>åªéœ€åœ¨åˆ›å»º <code>eTestView</code> çš„å‰ååŠ ä¸Šå¦‚ä¸‹å‡ è¡Œï¼Œé»„è‰²è­¦å‘Šå°±æ¶ˆå¤±äº†ğŸ˜„</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#pragma clang diagnostic push</span>
</span><span class='line'><span class="cp">#pragma clang diagnostic ignored &quot;-Wunused-variable&quot;</span>
</span><span class='line'><span class="bp">UIView</span> <span class="o">*</span><span class="n">eTestView</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="cp">#pragma clang diagnostic pop</span>
</span></code></pre></td></tr></table></div></figure>


<p>è‡³äºè­¦å‘Šæ ‡è¯†ç¬¦ï¼Œé¼ æ ‡ç‚¹å‡ ä¸‹å°±å¯ä»¥æ‰¾åˆ°ã€‚</p>

<p>å¦‚ä¸‹å›¾ï¼Œå³å‡»æŸä¸ªè­¦å‘Šï¼Œé€‰æ‹© <code>Reveal in Log</code>ï¼ˆæœ‰æ—¶è¿™ä¸ªé€‰é¡¹å¯èƒ½æ˜¯ç½®ç°çŠ¶æ€ï¼Œä¸èƒ½é€‰æ‹©ï¼Œå¯ä»¥å°è¯•ç¼–è¯‘ä¸‹é¡¹ç›®ï¼Œæˆ–è€…é€€å‡º Xcode é‡æ–°æ¥ä¸€æ¬¡ï¼‰</p>

<p><img src="http://lengmolehongyan.github.io/images/QQ20151213-1@2x.png" alt="Reveal in Log" /></p>

<p>ä¸‹å›¾çº¢è‰²æ¡†ä¸­ï¼Œä¸­æ‹¬å·å†…éƒ¨çš„å°±æ˜¯è­¦å‘Šæ ‡è¯†ç¬¦ï¼ˆå…ˆè¦ç‚¹å‡»å³ä¸Šè§’å±•å¼€è­¦å‘Šæ‰èƒ½çœ‹åˆ°è¿™ä¸€å¤§å †ä¿¡æ¯ï¼‰</p>

<p><img src="http://lengmolehongyan.github.io/images/QQ20151213-2@2x.png" alt="è­¦å‘Šæ ‡è¯†ç¬¦" /></p>

<h2>åœ¨ Build Settings ä¸­é¡¹ç›®å…¨å±€å¿½ç•¥è­¦å‘Š</h2>

<p>åœ¨é¡¹ç›®çš„ <code>Build Settings</code> ä¸­ä¹Ÿå¯ä»¥è®¾ç½®å¿½ç•¥æŸç§æˆ–å¤šç§ç±»å‹çš„è­¦å‘Šï¼Œä¸è¿‡åœ¨è¿™è®¾ç½®çš„å½±å“èŒƒå›´å°±æ˜¯æ•´ä¸ªé¡¹ç›®çš„äº†ï¼Œè¦ä¸‰æ€è€Œåè¡Œï¼Œä¸ç„¶å°±æ˜¯ç»™è‡ªå·±æŒ–å‘ã€‚</p>

<p>è¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨ <code>Build Settings</code> ä¸­æ‰¾åˆ° <code>Custom Compiler Flags</code>ï¼ŒåŒå‡» <code>Other Warning Flags</code>ï¼ˆå¯ä»¥é…ç½® <code>Debug</code> å’Œ <code>Release</code> ç¯å¢ƒï¼‰ï¼Œå¡«å…¥ <code>-Wno-unused-variable</code>ï¼Œå®Œæˆåï¼Œç¼–è¯‘é¡¹ç›®ï¼Œé¡¹ç›®ä¸­æ‰€æœ‰çš„æ­¤ç±»å‹è­¦å‘Šéƒ½æ²¡æœ‰äº†ã€‚</p>

<p><img src="http://lengmolehongyan.github.io/images/QQ20151213-4@2x.png" alt="Build Settings ä¸­é¡¹ç›®å…¨å±€å¿½ç•¥è­¦å‘Š" /></p>

<p>è¿™é‡Œæ‰€å¡«å†™çš„å†…å®¹è§„åˆ™ï¼Œä»…ä»…æ˜¯åœ¨ç¬¬ä¸€ç§æ–¹æ³•ä¸­æ‰¾åˆ°çš„è­¦å‘Šæ ‡è¯†ç¬¦ä¸­çš„ <code>W</code> å­—æ¯åé¢åŠ ä¸Š <code>no-</code> å°±å¯ä»¥äº†ã€‚</p>

<h2>CocoaPods å¯¼å…¥ç¬¬ä¸‰æ–¹åº“å¿½ç•¥è­¦å‘Š</h2>

<p>é€šè¿‡ CocoaPods ç»™é¡¹ç›®å¯¼å…¥äº†ä¸€äº›ç¬¬ä¸‰æ–¹åº“ï¼Œè¿™äº›åº“é‡Œé¢æˆ–å¤šæˆ–å°‘ä¼šæœ‰äº›è­¦å‘Šï¼Œæƒ³æ¶ˆé™¤è¿™äº›è­¦å‘Šï¼Œå¾ˆç®€å•ï¼Œåªéœ€åœ¨ <code>Podfile</code> ä¸­åŠ ä¸Šè¿™ä¸€å¥ <code>inhibit_all_warnings!</code>ï¼Œæ‰€æœ‰é€šè¿‡ CocoaPods å®‰è£…çš„ç¬¬ä¸‰åº“çš„è­¦å‘Šå°±æ²¡æœ‰äº†ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è®¡ç®—ä»£ç æ‰§è¡Œæ—¶é—´å·®]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/12/05/ji-suan-dai-ma-zhi-xing-shi-jian-chai/"/>
    <updated>2015-12-05T23:53:21+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/12/05/ji-suan-dai-ma-zhi-xing-shi-jian-chai</id>
    <content type="html"><![CDATA[<p>å¼€å‘ä¸­ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦çŸ¥é“æŸä¸ªæ•ˆæœåˆ°åº•è€—æ—¶å¤šé•¿æ—¶é—´ï¼Œå¯èƒ½æƒ³åˆ°ç”¨ <code>Foundation</code> æ¡†æ¶ä¸­çš„ <code>NSDate</code> ç±»æ¥è®¡ç®—ï¼Œæ¯”å¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSDate</span> <span class="o">*</span><span class="n">previousDate</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSDate</span> <span class="n">date</span><span class="p">];</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="n">NSTimeInterval</span> <span class="n">timeInterval</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSDate</span> <span class="n">date</span><span class="p">]</span> <span class="nl">timeIntervalSinceDate</span><span class="p">:</span><span class="n">previousDate</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨ <code>CoreFoundation</code> æ¡†æ¶ä¸­ï¼Œæœ‰ä¸€ä¸ªå‡½æ•°è¿”å›å½“å‰ç³»ç»Ÿçš„ç»å¯¹æ—¶é—´ï¼Œä¹Ÿå¯ä»¥ç”¨åšè®¡ç®—æ—¶é—´å·®ã€‚å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">CFAbsoluteTime</span> <span class="n">previousTime</span> <span class="o">=</span> <span class="n">CFAbsoluteTimeGetCurrent</span><span class="p">();</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="n">CFAbsoluteTime</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">CFAbsoluteTimeGetCurrent</span><span class="p">();</span>
</span><span class='line'><span class="n">CFAbsoluteTime</span> <span class="n">timeInterval</span> <span class="o">=</span> <span class="n">currentTime</span> <span class="o">-</span> <span class="n">previousTime</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è§£å†³ Xcode å‡çº§æ’ä»¶å¤±æ•ˆ]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/12/03/jie-jue-xcode-sheng-ji-cha-jian-shi-xiao/"/>
    <updated>2015-12-03T23:50:08+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/12/03/jie-jue-xcode-sheng-ji-cha-jian-shi-xiao</id>
    <content type="html"><![CDATA[<ul>
<li>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹ä»£ç è·å–åˆ° <code>DVTPlugInCompatibilityUUID</code></li>
</ul>


<p></p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>defaults read /Applications/Xcode.app/Contents/Info DVTPlugInCompatibilityUUID</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œæœ€åä¸€é¡¹æ˜¯ä¸Šä¸€æ­¥è·å–åˆ°çš„ <code>DVTPlugInCompatibilityUUID</code></li>
</ul>


<p></p>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>find ~/Library/Application\ Support/Developer/Shared/Xcode/Plug-ins -name Info.plist -maxdepth 3 | xargs -I{} defaults write {} DVTPlugInCompatibilityUUIDs -array-add æ­¤å¤„ä¸ºä¸Šä¸€æ­¥è·å¾—çš„ UUID</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ç»ˆç«¯æ‰§è¡Œå®Œä¸Šé¢å‘½ä»¤åï¼Œæ‰“å¼€ Xcodeï¼Œä¼šæœ‰ä¸‹å›¾æç¤ºï¼Œç‚¹å‡» <code>Load Bundles</code>ï¼Œå°±ä¼šåŠ è½½ Xcode æ’ä»¶ç›®å½•ä¸­å·²å®‰è£…çš„æ’ä»¶ã€‚</li>
</ul>


<p></p>




<!--more-->


<p><img src="http://lengmolehongyan.github.io/images/QQ20151204-0@2x.png" alt="Load Bundles" /></p>

<p>~~~ ğŸ˜Š OVER ğŸ˜Š ~~~</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Can't Add Self as Subview å´©æºƒè§£å†³åŠæ³•]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/10/30/cant-add-self-as-subview-beng-kui-jie-jue-ban-fa/"/>
    <updated>2015-10-30T23:14:49+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/10/30/cant-add-self-as-subview-beng-kui-jie-jue-ban-fa</id>
    <content type="html"><![CDATA[<h2>å‰è¨€</h2>

<p>æŸ¥çœ‹é¡¹ç›®çš„å´©æºƒæ±‡æ€»ï¼Œä¸€ç›´æœ‰ä¸€ä¸ª bug å­˜åœ¨ï¼Œä¹‹å‰ä¹Ÿæœ‰æ³¨æ„è¿‡ï¼Œåªå› è¿™ä¸ª bug çš„å´©æºƒå †æ ˆæ—¥å¿—è§£æå‡ºæ¥å¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œä¹Ÿä¸çŸ¥è¯¥æ€ä¹ˆå¤ç°ï¼Œå°±æ’‚ä¸‹äº†ã€‚</p>

<p>ä½†ç°åœ¨è¿™ä¸ª bug å´©æºƒå‘ç”Ÿæ¬¡æ•°è¹­è¹­æ¶¨ï¼Œå´©æºƒå æ¯”é«˜äº†èµ·æ¥ï¼Œä¸å¾—ä¸é‡è§†èµ·æ¥ã€‚</p>

<p>ç‚¹è¿›å´©æºƒè¯¦æƒ…ï¼Œåªæœ‰çŸ­çŸ­çš„ä¸€å¥ <code>Can't add self as subview</code>ã€‚</p>

<!--more-->


<p>å´©æºƒè°ƒç”¨å †æ ˆè§£æå‡ºæ¥å¦‚ä¸‹ï¼š</p>

<p><img src="http://7xjhyk.com1.z0.glb.clouddn.com/QQ20151031-0@2x.png" alt="å´©æºƒè°ƒç”¨å †æ ˆè§£æ" /></p>

<p>å¯¹è§£å†³é—®é¢˜æ ¹æœ¬èµ·ä¸äº†ä½œç”¨ï¼Œåªèƒ½ä¾é  Google äº†ã€‚</p>

<h2>bug å¤ç°</h2>

<p>åœ¨ StackOverflow ä¸Šæ‰¾åˆ°å¤ç°æ­¤ bug çš„æ–¹æ³•ï¼Œå°è¯•åŒæ—¶ <code>push</code> ä¸¤ä¸ªæ§åˆ¶å™¨ï¼Œæˆ–è€…åŒæ—¶ <code>push</code> å’Œ <code>pop</code> ä¸€ä¸ªæ§åˆ¶å™¨ã€‚</p>

<p><img src="http://i.stack.imgur.com/93n6V.png" alt="æµ‹è¯•åŒæ—¶ push ä¸¤ä¸ªæ§åˆ¶å™¨" /></p>

<p>ä¸Šå›¾æ˜¯å½“æ—¶ä¸€å›ç­”æ­¤é—®é¢˜äººçš„è¿è¡Œç»“æœï¼Œä½†ç°åœ¨æµ‹è¯•å¹¶ä¸ä¼šå¼•èµ·å´©æºƒï¼Œä¸è¿‡åŒæ—¶ <code>push</code> ä¸€ä¸ªæ§åˆ¶å™¨æ˜¯ä¼šå¯¼è‡´å´©æºƒçš„ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹å›¾ï¼š</p>

<p><img src="http://7xjhyk.com1.z0.glb.clouddn.com/QQ20151105-0@2x.png" alt="æµ‹è¯•åŒæ—¶ push ä¸€ä¸ªæ§åˆ¶å™¨" /></p>

<h2>è§£å†³åŠæ³•</h2>

<p>åˆ›å»ºä¸€ä¸ªåˆ†ç±»ï¼Œæ‹¦æˆªæ§åˆ¶å™¨å…¥æ ˆ\å‡ºæ ˆçš„æ–¹æ³•è°ƒç”¨ï¼Œé€šè¿‡å®‰å…¨çš„æ–¹å¼ï¼Œç¡®ä¿å½“æœ‰æ§åˆ¶å™¨æ­£åœ¨è¿›è¡Œå…¥æ ˆ\å‡ºæ ˆæ“ä½œæ—¶ï¼Œæ²¡æœ‰å…¶ä»–å…¥æ ˆ\å‡ºæ ˆæ“ä½œã€‚</p>

<p>æ­¤åˆ†ç±»ç”¨åˆ°è¿è¡Œæ—¶ (Runtime) çš„æ–¹æ³•äº¤æ¢ <code>Method Swizzling</code>ï¼Œå› æ­¤åªéœ€è¦å¤åˆ¶ä¸‹é¢çš„ä»£ç åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œæ­¤ bug å°±ä¸å¤å­˜åœ¨äº†ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;UINavigationController+Consistent.h&quot;</span>
</span><span class='line'><span class="cp">#import &lt;objc/runtime.h&gt;</span>
</span><span class='line'><span class="c1">/// This char is used to add storage for the isPushingViewController property.</span>
</span><span class='line'><span class="k">static</span> <span class="kt">char</span> <span class="k">const</span> <span class="o">*</span> <span class="k">const</span> <span class="n">ObjectTagKey</span> <span class="o">=</span> <span class="s">&quot;ObjectTag&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">@interface</span> <span class="bp">UINavigationController</span> <span class="p">()</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">readwrite</span><span class="p">,</span><span class="k">getter</span> <span class="o">=</span> <span class="n">isViewTransitionInProgress</span><span class="p">)</span> <span class="kt">BOOL</span> <span class="n">viewTransitionInProgress</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="bp">UINavigationController</span> <span class="nl">(Consistent)</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setViewTransitionInProgress:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">property</span> <span class="p">{</span>
</span><span class='line'>    <span class="bp">NSNumber</span> <span class="o">*</span><span class="n">number</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithBool</span><span class="p">:</span><span class="n">property</span><span class="p">];</span>
</span><span class='line'>    <span class="n">objc_setAssociatedObject</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">ObjectTagKey</span><span class="p">,</span> <span class="n">number</span> <span class="p">,</span> <span class="n">OBJC_ASSOCIATION_RETAIN</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nf">isViewTransitionInProgress</span> <span class="p">{</span>
</span><span class='line'>    <span class="bp">NSNumber</span> <span class="o">*</span><span class="n">number</span> <span class="o">=</span> <span class="n">objc_getAssociatedObject</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="n">ObjectTagKey</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="n">number</span> <span class="n">boolValue</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#pragma mark - Intercept Pop, Push, PopToRootVC</span>
</span><span class='line'><span class="c1">/// @name Intercept Pop, Push, PopToRootVC</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nf">safePopToRootViewControllerAnimated:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">viewTransitionInProgress</span><span class="p">)</span> <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">animated</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">viewTransitionInProgress</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//-- This is not a recursion, due to method swizzling the call below calls the original  method.</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">safePopToRootViewControllerAnimated</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nf">safePopToViewController:</span><span class="p">(</span><span class="bp">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">animated:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">viewTransitionInProgress</span><span class="p">)</span> <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">animated</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">viewTransitionInProgress</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//-- This is not a recursion, due to method swizzling the call below calls the original  method.</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">safePopToViewController</span><span class="p">:</span><span class="n">viewController</span> <span class="nl">animated</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nf">safePopViewControllerAnimated:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">viewTransitionInProgress</span><span class="p">)</span> <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">animated</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">viewTransitionInProgress</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//-- This is not a recursion, due to method swizzling the call below calls the original  method.</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">safePopViewControllerAnimated</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">safePushViewController:</span><span class="p">(</span><span class="bp">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">animated:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">//-- If we are already pushing a view controller, we dont push another one.</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">isViewTransitionInProgress</span> <span class="o">==</span> <span class="nb">NO</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//-- This is not a recursion, due to method swizzling the call below calls the original  method.</span>
</span><span class='line'>        <span class="p">[</span><span class="nb">self</span> <span class="nl">safePushViewController</span><span class="p">:</span><span class="n">viewController</span> <span class="nl">animated</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">animated</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nb">self</span><span class="p">.</span><span class="n">viewTransitionInProgress</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// This is confirmed to be App Store safe.</span>
</span><span class='line'><span class="c1">// If you feel uncomfortable to use Private API, you could also use the delegate method navigationController:didShowViewController:animated:.</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">safeDidShowViewController:</span><span class="p">(</span><span class="bp">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">animated:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//-- This is not a recursion. Due to method swizzling this is calling the original method.</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span> <span class="nl">safeDidShowViewController</span><span class="p">:</span><span class="n">viewController</span> <span class="nl">animated</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">viewTransitionInProgress</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// If the user doesnt complete the swipe-to-go-back gesture, we need to intercept it and set the flag to NO again.</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">navigationController:</span><span class="p">(</span><span class="bp">UINavigationController</span> <span class="o">*</span><span class="p">)</span><span class="nv">navigationController</span> <span class="nf">willShowViewController:</span><span class="p">(</span><span class="bp">UIViewController</span> <span class="o">*</span><span class="p">)</span><span class="nv">viewController</span> <span class="nf">animated:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">id</span><span class="o">&lt;</span><span class="bp">UIViewControllerTransitionCoordinator</span><span class="o">&gt;</span> <span class="n">tc</span> <span class="o">=</span> <span class="n">navigationController</span><span class="p">.</span><span class="n">topViewController</span><span class="p">.</span><span class="n">transitionCoordinator</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">tc</span> <span class="nl">notifyWhenInteractionEndsUsingBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="bp">UIViewControllerTransitionCoordinatorContext</span><span class="o">&gt;</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">viewTransitionInProgress</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
</span><span class='line'>        <span class="c1">//--Reenable swipe back gesture.</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">interactivePopGestureRecognizer</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="bp">UIGestureRecognizerDelegate</span><span class="o">&gt;</span><span class="p">)</span><span class="n">viewController</span><span class="p">;</span>
</span><span class='line'>        <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">interactivePopGestureRecognizer</span> <span class="nl">setEnabled</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>    <span class="c1">//-- Method swizzling wont work in the case of a delegate so:</span>
</span><span class='line'>    <span class="c1">//-- forward this method to the original delegate if there is one different than ourselves.</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">navigationController</span><span class="p">.</span><span class="n">delegate</span> <span class="o">!=</span> <span class="nb">self</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="n">navigationController</span><span class="p">.</span><span class="n">delegate</span> <span class="nl">navigationController</span><span class="p">:</span><span class="n">navigationController</span>
</span><span class='line'>                                     <span class="nl">willShowViewController</span><span class="p">:</span><span class="n">viewController</span>
</span><span class='line'>                                                   <span class="nl">animated</span><span class="p">:</span><span class="n">animated</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">+</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">load</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//-- Exchange the original implementation with our custom one.</span>
</span><span class='line'>    <span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">pushViewController</span><span class="p">:</span><span class="nl">animated</span><span class="p">:)),</span> <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">safePushViewController</span><span class="p">:</span><span class="nl">animated</span><span class="p">:)));</span>
</span><span class='line'>    <span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">didShowViewController</span><span class="p">:</span><span class="nl">animated</span><span class="p">:)),</span> <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">safeDidShowViewController</span><span class="p">:</span><span class="nl">animated</span><span class="p">:)));</span>
</span><span class='line'>    <span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">popViewControllerAnimated</span><span class="p">:)),</span> <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">safePopViewControllerAnimated</span><span class="p">:)));</span>
</span><span class='line'>    <span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">popToRootViewControllerAnimated</span><span class="p">:)),</span> <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">safePopToRootViewControllerAnimated</span><span class="p">:)));</span>
</span><span class='line'>    <span class="n">method_exchangeImplementations</span><span class="p">(</span><span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">popToViewController</span><span class="p">:</span><span class="nl">animated</span><span class="p">:)),</span> <span class="n">class_getInstanceMethod</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="k">@selector</span><span class="p">(</span><span class="nl">safePopToViewController</span><span class="p">:</span><span class="nl">animated</span><span class="p">:)));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FMDB ä½¿ç”¨æ–¹æ³•]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/10/22/fmdb-xue-xi-zong-jie/"/>
    <updated>2015-10-22T22:41:56+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/10/22/fmdb-xue-xi-zong-jie</id>
    <content type="html"><![CDATA[<blockquote><p>ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹åº“ï¼ŒREADME ä¹Ÿæ˜¯å¾ˆä¼˜ç§€çš„ï¼Œç†è§£äº† READMEï¼Œä¼šå¯¹ä½¿ç”¨å¸¦æ¥å¾ˆå¤šä¾¿åˆ©ã€‚</p></blockquote>

<h2>ARC å’Œ MRC</h2>

<p>é¡¹ç›®ä¸­ä½¿ç”¨ ARC è¿˜æ˜¯ MRCï¼Œå¯¹ä½¿ç”¨ FMDB éƒ½æ²¡æœ‰ä»»ä½•å½±å“ï¼ŒFMDB ä¼šåœ¨ç¼–è¯‘é¡¹ç›®æ—¶è‡ªåŠ¨åŒ¹é…ã€‚</p>

<h2>ä½¿ç”¨</h2>

<p>åœ¨ FMDB ä¸­æœ‰ä¸‰ä¸ªé‡è¦çš„ç±»ï¼š</p>

<ol>
<li><code>FMDatabase</code>ï¼šæ˜¯ä¸€ä¸ªæä¾› SQLite æ•°æ®åº“çš„ç±»ï¼Œç”¨äºæ‰§è¡Œ SQL è¯­å¥ã€‚</li>
<li><code>FMResultSet</code>ï¼šç”¨åœ¨ <code>FMDatabase</code> ä¸­æ‰§è¡ŒæŸ¥è¯¢çš„ç»“æœçš„ç±»ã€‚</li>
<li><code>FMDatabaseQueue</code>ï¼šåœ¨å¤šçº¿ç¨‹ä¸‹æŸ¥è¯¢å’Œæ›´æ–°æ•°æ®åº“ç”¨åˆ°çš„ç±»ã€‚</li>
</ol>


<p></p>




<!--more-->


<h2>æ•°æ®åº“åˆ›å»º</h2>

<p><code>FMDatabase</code> æ˜¯é€šè¿‡ä¸€ä¸ª SQLite æ•°æ®åº“æ–‡ä»¶è·¯å¾„åˆ›å»ºçš„ï¼Œæ­¤è·¯å¾„å¯ä»¥æ˜¯ä»¥ä¸‹ä¸‰è€…ä¹‹ä¸€ï¼š</p>

<ol>
<li>ä¸€ä¸ªæ–‡ä»¶çš„ç³»ç»Ÿè·¯å¾„ã€‚ç£ç›˜ä¸­å¯ä»¥ä¸å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œå› ä¸ºå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨ä¸ºä½ åˆ›å»ºã€‚</li>
<li>ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸² <code>@""</code>ã€‚ä¼šåœ¨ä¸´æ—¶ä½ç½®åˆ›å»ºä¸€ä¸ªç©ºçš„æ•°æ®åº“ï¼Œå½“ <code>FMDatabase</code> è¿æ¥å…³é—­æ—¶ï¼Œè¯¥æ•°æ®åº“ä¼šè¢«åˆ é™¤ã€‚</li>
<li><code>NULL</code>ã€‚ä¼šåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå½“ <code>FMDatabase</code> è¿æ¥å…³é—­æ—¶ï¼Œè¯¥æ•°æ®åº“ä¼šè¢«é”€æ¯ã€‚</li>
</ol>


<p></p>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// åˆ›å»ºæ•°æ®åº“ç¤ºä¾‹</span>
</span><span class='line'><span class="n">FMDatabase</span> <span class="o">*</span><span class="n">db</span> <span class="o">=</span> <span class="p">[</span><span class="n">FMDatabase</span> <span class="nl">databaseWithPath</span><span class="p">:</span><span class="s">@&quot;/tmp/tmp.db&quot;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>æ‰“å¼€æ•°æ®åº“</h2>

<p>æ•°æ®åº“å¿…é¡»æ˜¯æ‰“å¼€çŠ¶æ€ï¼Œæ‰èƒ½ä¸ä¹‹äº¤äº’ã€‚å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„èµ„æºå’Œæƒé™æ¥æ‰“å¼€\åˆ›å»ºæ•°æ®åº“ï¼Œæ•°æ®åº“ä¼šæ‰“å¼€å¤±è´¥ã€‚</p>

<h2>æ•°æ®åº“æ›´æ–°</h2>

<p>SQL è¯­å¥ä¸­é™¤è¿‡ <code>SELECT</code> è¯­å¥éƒ½å¯ä»¥ç§°ä¹‹ä¸ºæ›´æ–°æ“ä½œã€‚åŒ…æ‹¬ <code>CREATE</code>ï¼Œ<code>UPDATE</code>ï¼Œ<code>INSERT</code>ï¼Œ<code>ALTER</code>ï¼Œ<code>COMMIT</code>ï¼Œ<code>BEGIN</code>ï¼Œ<code>DETACH</code>ï¼Œ<code>DROP</code>ï¼Œ<code>END</code>ï¼Œ<code>EXPLAIN</code>ï¼Œ<code>VACUUM</code>ï¼Œ<code>REPLACE</code> ç­‰ã€‚ä¸€èˆ¬åªè¦ä¸æ˜¯ä»¥ <code>SELECT</code> å¼€å¤´çš„ SQL è¯­å¥ï¼Œéƒ½æ˜¯æ›´æ–°è¯­å¥ã€‚</p>

<p>æ‰§è¡Œæ›´æ–°è¯­å¥åä¼šè¿”å›ä¸€ä¸ª <code>BOOL</code> å€¼ï¼Œè¿”å› <code>YES</code> è¡¨ç¤ºæ‰§è¡Œæ›´æ–°è¯­å¥æˆåŠŸï¼Œè¿”å› <code>NO</code> è¡¨ç¤ºå‡ºç°é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <code>-lastErrorMessage</code> å’Œ <code>-lastErrorCode</code> æ–¹æ³•è·å–æ›´å¤šé”™è¯¯ä¿¡æ¯ã€‚</p>

<h2>æ•°æ®åº“æŸ¥è¯¢</h2>

<p>é€šè¿‡è°ƒç”¨ <code>-executeQuery...</code> æ–¹æ³•ä¹‹ä¸€æ‰§è¡Œ <code>SELECT</code> è¯­å¥è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢æ“ä½œã€‚</p>

<p>æ‰§è¡ŒæŸ¥è¯¢æ“ä½œåï¼Œå¦‚æœæˆåŠŸä¼šè¿”å›ä¸€ä¸ª <code>FMResultSet</code> å¯¹è±¡ï¼Œåä¹‹ä¼šè¿”å› <code>nil</code>ã€‚é€šè¿‡ <code>-lastErrorMessage</code> å’Œ <code>-lastErrorCode</code> æ–¹æ³•å¯ä»¥ç¡®å®šä¸ºä»€ä¹ˆä¼šæŸ¥è¯¢å¤±è´¥ã€‚</p>

<p>ä¸ºäº†éå†æŸ¥è¯¢ç»“æœï¼Œéœ€è¦ <code>while()</code> å¾ªç¯ï¼Œç„¶åé€æ¡è®°å½•æŸ¥çœ‹ã€‚åœ¨ FMDB ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ç®€å•æ–¹å¼å®ç°ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">FMResultSet</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">db</span> <span class="nl">executeQuery</span><span class="p">:</span><span class="s">@&quot;SELECT * FROM myTable&quot;</span><span class="p">];</span>
</span><span class='line'><span class="k">while</span> <span class="p">([</span><span class="n">s</span> <span class="n">next</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// æ¯å¤©è®°å½•çš„æ£€ç´¢å€¼</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å³ä½¿åªéœ€è¦è·å–ä¸€ä¸ªæ•°æ®ï¼Œä¹Ÿè¿˜æ˜¯å¿…é¡»åœ¨è®¿é—®æŸ¥è¯¢ç»“æœå‰è°ƒç”¨ <code>-[FMResultSet next]</code>ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// ç¤ºä¾‹</span>
</span><span class='line'><span class="n">FMResultSet</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">db</span> <span class="nl">executeQuery</span><span class="p">:</span><span class="s">@&quot;SELECT COUNT(*) FROM myTable&quot;</span><span class="p">];</span>
</span><span class='line'><span class="k">if</span> <span class="p">([</span><span class="n">s</span> <span class="n">next</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">totalCount</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="nl">intForColumnIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>FMResultSet</code> æä¾›äº†å¾ˆå¤šæ–¹ä¾¿çš„æ–¹æ³•æ¥æŸ¥è¯¢æ•°æ®ï¼š</p>

<ul>
<li><code>intForColumn:</code></li>
<li><code>longForColumn:</code></li>
<li><code>longLongIntForColumn:</code></li>
<li><code>boolForColumn:</code></li>
<li><code>doubleForColumn:</code></li>
<li><code>stringForColumn:</code></li>
<li><code>dateForColumn:</code></li>
<li><code>dataForColumn:</code></li>
<li><code>dataNoCopyForColumn:</code></li>
<li><code>UTF8StringForColumn:</code></li>
<li><code>objectForColumn:</code></li>
</ul>


<p></p>


<p>è¿™äº›æ–¹æ³•éƒ½æœ‰ä¸€ä¸ª <code>{type}ForColumnIndex:</code> å˜ä½“ï¼Œæ˜¯åŸºäºåˆ—çš„ä½ç½®æ¥æŸ¥è¯¢æ•°æ®ã€‚</p>

<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ª <code>FMResultSet</code> æ²¡æœ‰å¿…è¦æ‰‹åŠ¨ <code>-close</code>ï¼Œå› ä¸ºç»“æœé›†åˆ (result set) è¢«é‡Šæ”¾æˆ–è€…æºæ•°æ®åº“å…³é—­ä¼šè‡ªåŠ¨å…³é—­ã€‚</p>

<h2>å…³é—­æ•°æ®åº“</h2>

<p>å½“å¯¹æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢å’Œæ›´æ–°æ“ä½œå®Œæˆåï¼Œéœ€è¦è°ƒç”¨ <code>-close</code> å…³é—­æ•°æ®åº“ <code>FMDatabase</code> çš„è¿æ¥ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// ç¤ºä¾‹</span>
</span><span class='line'><span class="p">[</span><span class="n">db</span> <span class="n">close</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>äº‹åŠ¡</h2>

<p><code>FMDatabase</code> å¯ä»¥é€šè¿‡è°ƒç”¨æ–¹æ³•æ¥å¼€å§‹å’Œæäº¤äº‹åŠ¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ‰§è¡Œå¼€å§‹\ç»“æŸäº‹åŠ¡  (begin\end transaction) è¯­å¥ã€‚</p>

<h2>å¤šè¯­å¥å’Œæ‰¹å¤„ç†</h2>

<p><code>FMDatabase</code> å¯ä»¥é€šè¿‡ <code>-executeStatements:withResultBlock:</code> æ–¹æ³•åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ‰§è¡Œå¤šè¯­å¥ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// ç¤ºä¾‹</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">sql</span> <span class="o">=</span> <span class="s">@&quot;create table bulktest1 (id integer primary key autoincrement, x text);&quot;</span>
</span><span class='line'>                 <span class="s">&quot;create table bulktest2 (id integer primary key autoincrement, y text);&quot;</span>
</span><span class='line'>                 <span class="s">&quot;create table bulktest3 (id integer primary key autoincrement, z text);&quot;</span>
</span><span class='line'>                 <span class="s">&quot;insert into bulktest1 (x) values (&#39;XXX&#39;);&quot;</span>
</span><span class='line'>                 <span class="s">&quot;insert into bulktest2 (y) values (&#39;YYY&#39;);&quot;</span>
</span><span class='line'>                 <span class="s">&quot;insert into bulktest3 (z) values (&#39;ZZZ&#39;);&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">success</span> <span class="o">=</span> <span class="p">[</span><span class="n">db</span> <span class="nl">executeStatements</span><span class="p">:</span><span class="n">sql</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="n">sql</span> <span class="o">=</span> <span class="s">@&quot;select count(*) as count from bulktest1;&quot;</span>
</span><span class='line'>       <span class="s">&quot;select count(*) as count from bulktest2;&quot;</span>
</span><span class='line'>       <span class="s">&quot;select count(*) as count from bulktest3;&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">success</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">db</span> <span class="nl">executeStatements</span><span class="p">:</span><span class="n">sql</span> <span class="nl">withResultBlock</span><span class="p">:</span><span class="o">^</span><span class="kt">int</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">dictionary</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="bp">NSInteger</span> <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">dictionary</span><span class="p">[</span><span class="s">@&quot;count&quot;</span><span class="p">]</span> <span class="n">integerValue</span><span class="p">];</span>
</span><span class='line'>    <span class="n">XCTAssertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">@&quot;expected one record for dictionary %@&quot;</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<h2>æ•°æ®å¤„ç†</h2>

<p>å½“ç»™ FMDB æä¾› SQL è¯­å¥æ—¶ï¼Œåœ¨æ’å…¥å‰ä¸åº”è¯¥å¤„ç†ä»»ä½•æ•°æ®ï¼Œè€Œåº”è¯¥ä½¿ç”¨æ ‡å‡†çš„ SQLite çš„ç»‘å®šè¯­æ³•ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="o">//</span> <span class="err">ç¤ºä¾‹</span>
</span><span class='line'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">myTable</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>?</code> é—®å·åœ¨ SQLite ä¸­æ„ä¸ºå³å°†æ’å…¥çš„å€¼çš„å ä½ç¬¦ï¼ŒFMDB æ‰§è¡Œè¯­å¥çš„æ–¹æ³•éƒ½æ¥å—å¤šä¸ªå‚æ•° (æˆ–è€…å‚æ•°é›†åˆï¼Œæ¯”å¦‚ <code>NSArray</code>ï¼Œ<code>NSDictionary</code>ï¼Œ<code>va_list</code>)ï¼Œå®ƒä»¬éƒ½ä¼šæ­£ç¡®è½¬ä¹‰ã€‚</p>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨å‘½åå‚æ•°è¯­æ³•ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="o">//</span> <span class="err">ç¤ºä¾‹</span>
</span><span class='line'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">myTable</span> <span class="k">VALUES</span> <span class="p">(:</span><span class="n">id</span><span class="p">,</span> <span class="p">:</span><span class="n">name</span><span class="p">,</span> <span class="p">:</span><span class="n">value</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™äº›å‚æ•°å¿…é¡»ä»¥å†’å·å¼€å¤´ï¼ŒSQLite è‡ªèº«æ”¯æŒå…¶ä»–å­—ç¬¦ï¼Œä½†æ˜¯å‘½åæ—¶å­—å…¸çš„é”®å†…éƒ¨ä»¥å†’å·å¼€å¤´ï¼Œå°±ä¸èƒ½åœ¨ä½ çš„å­—å…¸çš„é”®ä¸­åŒ…å«å†’å·ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// ç¤ºä¾‹</span>
</span><span class='line'><span class="bp">NSDictionary</span> <span class="o">*</span><span class="n">argsDict</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSDictionary</span> <span class="nl">dictionaryWithObjectsAndKeys</span><span class="p">:</span><span class="s">@&quot;My Name&quot;</span><span class="p">,</span> <span class="s">@&quot;name&quot;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable (name) VALUES (:name)&quot;</span> <span class="nl">withParameterDictionary</span><span class="p">:</span><span class="n">argsDict</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>å› æ­¤ï¼Œä¸åº”è¯¥å†™ç±»ä¼¼ä¸‹é¢è¿™è¡Œä¸€æ ·çš„é”™è¯¯ä»£ç ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// é”™è¯¯ç¤ºä¾‹</span>
</span><span class='line'><span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:[</span><span class="bp">NSString</span> <span class="nl">stringWithFormat</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (%@)&quot;</span><span class="p">,</span> <span class="s">@&quot;this has </span><span class="se">\&quot;</span><span class="s"> lots of &#39; bizarre </span><span class="se">\&quot;</span><span class="s"> quotes &#39;&quot;</span><span class="p">]];</span>
</span></code></pre></td></tr></table></div></figure>


<p>è€Œåº”è¯¥è¿™æ ·å†™ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// æ­£ç¡®ç¤ºä¾‹</span>
</span><span class='line'><span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (?)&quot;</span><span class="p">,</span> <span class="s">@&quot;this has </span><span class="se">\&quot;</span><span class="s"> lots of &#39; bizarre </span><span class="se">\&quot;</span><span class="s"> quotes &#39;&quot;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ‰€æœ‰ä¼ é€’ç»™ <code>-executeUpdate:</code> æ–¹æ³•çš„å‚æ•°éƒ½å¿…é¡»æ˜¯å¯¹è±¡ã€‚ä¸‹é¢å†™æ³•æ‰§è¡Œä¸ä¼šèµ·ä½œç”¨è€Œä¸”ä¼šå¼•å‘å´©æºƒï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// é”™è¯¯ç¤ºä¾‹</span>
</span><span class='line'><span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (?)&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ’å…¥ä¸€ä¸ªæ•°çš„æ­£ç¡®æ–¹æ³•æ˜¯æŠŠè¿™ä¸ªæ•°å­—åŒ…è£…æˆ <code>NSNumber</code> å¯¹è±¡ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// æ­£ç¡®ç¤ºä¾‹</span>
</span><span class='line'><span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (?)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:</span><span class="mi">42</span><span class="p">]];</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>-execute*WithFormat:</code> è¿™ä¸ªæ–¹æ³•å°†æ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// è½¬æ¢æˆå­—ç¬¦ä¸²ç¤ºä¾‹</span>
</span><span class='line'><span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdateWithFormat</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (@d)&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>-execute*WithFormat:</code> è¿™äº›æ–¹æ³•åé¢éƒ½å¯ä»¥æ¥æ ¼å¼å­—ç¬¦ä¸²å‚æ•°ï¼Œä»¥ä¸‹ % ç™¾åˆ†å·æ ¼å¼ç¬¦éƒ½æ˜¯å¯ä»¥è¯†åˆ«çš„ï¼š<code>%@</code>, <code>%c</code>, <code>%s</code>, <code>%d</code>, <code>%D</code>, <code>%i</code>, <code>%u</code>, <code>%U</code>, <code>%hi</code>, <code>%hu</code>, <code>%qi</code>, <code>%qu</code>, <code>%f</code>, <code>%g</code>, <code>%ld</code>, <code>%lu</code>, <code>%lld</code>, <code>%llu</code>ã€‚ä½¿ç”¨å…¶ä»–æ ¼å¼ç¬¦å¯èƒ½ä¼šå‡ºç°ä¸å¯é¢„çŸ¥çš„é—®é¢˜ã€‚å‡ºäºæŸç§åŸå› ï¼Œå¯èƒ½éœ€è¦åœ¨ä½ çš„ SQL è¯­å¥ä¸­ä½¿ç”¨ <code>%</code> å­—ç¬¦ï¼Œåº”è¯¥ä½¿ç”¨ç™¾åˆ†å·è½¬ä¹‰ä¸€ä¸‹ <code>%%</code>ã€‚</p>

<h2>FMDatabaseQueue é˜Ÿåˆ—å’Œçº¿ç¨‹å®‰å…¨</h2>

<p>åœ¨å¤šçº¿ç¨‹ä¸­åŒæ—¶ä½¿ç”¨ FMDatabase å•ä¾‹æ˜¯æå…¶é”™è¯¯çš„æƒ³æ³•ï¼Œä¼šå¯¼è‡´æ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ª FMDatabase å¯¹è±¡ã€‚ä¸è¦è·¨çº¿ç¨‹ä½¿ç”¨å•ä¾‹ï¼Œä¹Ÿä¸è¦åŒæ—¶è·¨å¤šçº¿ç¨‹ï¼Œä¸ç„¶ä¼šå¥”æºƒæˆ–è€…å¼‚å¸¸ã€‚</p>

<p><em>å› æ­¤ä¸è¦å®ä¾‹åŒ–ä¸€ä¸ª FMDatabase å•ä¾‹æ¥è·¨çº¿ç¨‹ä½¿ç”¨ã€‚</em></p>

<p>ç›¸åï¼Œä½¿ç”¨ FMDatabaseQueueï¼Œä¸‹é¢å°±æ˜¯å®ƒçš„ä½¿ç”¨æ–¹æ³•ï¼š</p>

<p>ç¬¬ä¸€ï¼Œåˆ›å»ºé˜Ÿåˆ—ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// åˆ›å»º FMdatabaseQueue ç¤ºä¾‹</span>
</span><span class='line'><span class="n">FMDatabaseQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">FMDatabaseQueue</span> <span class="nl">databaseQueueWithPath</span><span class="p">:</span><span class="n">aPath</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åè¿™æ ·ä½¿ç”¨ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// ç¤ºä¾‹</span>
</span><span class='line'><span class="p">[</span><span class="n">queue</span> <span class="nl">inDatabase</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">FMDatabase</span> <span class="o">*</span><span class="n">db</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (?)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:</span><span class="mi">1</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (?)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:</span><span class="mi">2</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (?)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:</span><span class="mi">3</span><span class="p">]];</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">FMResultSet</span> <span class="o">*</span><span class="n">rs</span> <span class="o">=</span> <span class="p">[</span><span class="n">db</span> <span class="nl">executeQuery</span><span class="p">:</span><span class="s">@&quot;select * from foo&quot;</span><span class="p">];</span>
</span><span class='line'>  <span class="k">while</span> <span class="p">([</span><span class="n">rs</span> <span class="n">next</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">...</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<p>æŠŠæ“ä½œæ”¾åœ¨äº‹åŠ¡ä¸­ä¹Ÿå¾ˆç®€å•ï¼Œæ¯”å¦‚ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// ç¤ºä¾‹</span>
</span><span class='line'><span class="p">[</span><span class="n">queue</span> <span class="nl">inTransaction</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">FMDatabase</span> <span class="o">*</span><span class="n">db</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="o">*</span><span class="n">rollback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (?)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:</span><span class="mi">1</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (?)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:</span><span class="mi">2</span><span class="p">]];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (?)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:</span><span class="mi">3</span><span class="p">]];</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">whoopsSomethingWrongHappened</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="o">*</span><span class="n">rollback</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">// ...</span>
</span><span class='line'>  <span class="p">[</span><span class="n">db</span> <span class="nl">executeUpdate</span><span class="p">:</span><span class="s">@&quot;INSERT INTO myTable VALUES (?)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">NSNumber</span> <span class="nl">numberWithInt</span><span class="p">:</span><span class="mi">4</span><span class="p">]];</span>
</span><span class='line'><span class="p">}];</span>
</span></code></pre></td></tr></table></div></figure>


<p>FMDatabase å°†å—ä»£ç  block è¿è¡Œåœ¨ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸Šï¼Œå³ä½¿åœ¨å¤šçº¿ç¨‹åŒæ—¶è°ƒç”¨ FMDatabaseQueue çš„æ–¹æ³•ï¼Œå®ƒä»¬ä»ç„¶è¿˜æ˜¯é¡ºåºæ‰§è¡Œã€‚è¿™ç§æŸ¥è¯¢å’Œæ›´æ–°æ–¹å¼ä¸ä¼šå½±å“å…¶å®ƒï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>

<h2>åŸºäº block è‡ªå®šä¹‰ SQLite å‡½æ•°</h2>

<p>è¿™æ˜¯å¯ä»¥çš„ï¼Œä¾‹å­å¯ä»¥åœ¨ main.m ä¸­çš„ <code>makeFunctionNamed:</code> æ–¹æ³•æŸ¥çœ‹ã€‚</p>

<h2>Swift</h2>

<p>åœ¨ Swift é¡¹ç›®ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ FMDBï¼Œéœ€è¦åšä»¥ä¸‹æ­¥éª¤ï¼š</p>

<ol>
<li>å°† FMDB çš„ <code>.m</code> å’Œ <code>.h</code> å…¨éƒ¨æ–‡ä»¶æ‹–è¿›ä½ çš„é¡¹ç›®ã€‚</li>
<li>å¦‚æœ Xcode æç¤ºåˆ›å»ºæ¡¥æ¥æ–‡ä»¶ï¼Œéœ€è¦ç‚¹å‡»åˆ›å»ºã€‚å¦‚æœæ²¡æœ‰æç¤ºï¼Œä¸”é¡¹ç›®ä¸­ä¹Ÿæ²¡æœ‰æ¡¥æ¥æ–‡ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚<a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/MixandMatch.html#//apple_ref/doc/uid/TP40014216-CH10-XID_76">ç‚¹æ­¤æŸ¥çœ‹æ¡¥æ¥æ–‡ä»¶æ›´å¤šä¿¡æ¯</a></li>
<li>åœ¨æ¡¥æ¥æ–‡ä»¶ä¸­ï¼Œæ·»åŠ è¿™è¡Œä»£ç ï¼š<code>#import "FMDB.h"</code></li>
<li>å¯ä»¥ä» &ldquo;src/extra/Swift Extension&rdquo; æ–‡ä»¶å¤¹ä¸­æ‹·è´ <code>FMDatabaseVariadic.swift</code> æ–‡ä»¶åˆ°é¡¹ç›®ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>executeUpdate</code> å’Œ <code>executeQuery</code> å¤šå‚æ•°äº†ã€‚</li>
</ol>


<p></p>


<p>åšå®Œä¸Šè¿°å‡ æ­¥ï¼Œå°±å¯ä»¥ä½¿ç”¨ FMDatabase å†™ Swift ä»£ç äº†ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// ç¤ºä¾‹</span>
</span><span class='line'><span class="k">let</span> <span class="n">documentsFolder</span> <span class="o">=</span> <span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(.</span><span class="n">DocumentDirectory</span><span class="p">,</span> <span class="p">.</span><span class="n">UserDomainMask</span><span class="p">,</span> <span class="nb">true</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="kt">as</span> <span class="n">String</span>
</span><span class='line'><span class="k">let</span> <span class="n">path</span> <span class="o">=</span> <span class="n">documentsFolder</span><span class="p">.</span><span class="n">stringByAppendingPathComponent</span><span class="p">(</span><span class="s">&quot;test.sqlite&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">database</span> <span class="o">=</span> <span class="n">FMDatabase</span><span class="p">(</span><span class="nl">path</span><span class="p">:</span> <span class="n">path</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">!</span><span class="n">database</span><span class="p">.</span><span class="n">open</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="s">&quot;Unable to open database&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">!</span><span class="n">database</span><span class="p">.</span><span class="n">executeUpdate</span><span class="p">(</span><span class="s">&quot;create table test(x text, y text, z text)&quot;</span><span class="p">,</span> <span class="nl">withArgumentsInArray</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="s">&quot;create table failed: \(database.lastErrorMessage())&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">!</span><span class="n">database</span><span class="p">.</span><span class="n">executeUpdate</span><span class="p">(</span><span class="s">&quot;insert into test (x, y, z) values (?, ?, ?)&quot;</span><span class="p">,</span> <span class="nl">withArgumentsInArray</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="s">&quot;insert 1 table failed: \(database.lastErrorMessage())&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">!</span><span class="n">database</span><span class="p">.</span><span class="n">executeUpdate</span><span class="p">(</span><span class="s">&quot;insert into test (x, y, z) values (?, ?, ?)&quot;</span><span class="p">,</span> <span class="nl">withArgumentsInArray</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;e&quot;</span><span class="p">,</span> <span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="s">&quot;g&quot;</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="s">&quot;insert 2 table failed: \(database.lastErrorMessage())&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="k">let</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">database</span><span class="p">.</span><span class="n">executeQuery</span><span class="p">(</span><span class="s">&quot;select x, y, z from test&quot;</span><span class="p">,</span> <span class="nl">withArgumentsInArray</span><span class="p">:</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">while</span> <span class="n">rs</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">rs</span><span class="p">.</span><span class="n">stringForColumn</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="n">rs</span><span class="p">.</span><span class="n">stringForColumn</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">let</span> <span class="n">z</span> <span class="o">=</span> <span class="n">rs</span><span class="p">.</span><span class="n">stringForColumn</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">println</span><span class="p">(</span><span class="s">&quot;x = \(x); y = \(y); z = \(z)&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="s">&quot;select failed: \(database.lastErrorMessage())&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">database</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>æœ¬æ–‡å®é™…æ˜¯å¯¹ <a href="https://github.com/ccgus/fmdb">FMDB</a> çš„ README ç®€å•ç¿»è¯‘ï¼Œä»¥æ–¹ä¾¿ä½¿ç”¨ FMDBã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Directory Not Found for Option]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/09/23/ios9-gua-pei/"/>
    <updated>2015-09-23T10:47:48+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/09/23/ios9-gua-pei</id>
    <content type="html"><![CDATA[<p>åœ¨ Xcode7 ä¸‹ç¼–è¯‘é¡¹ç›®ï¼ŒæŠ¥äº†å¦‚ä¸‹è­¦å‘Šï¼š</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ld: warning: directory not found for option 
</span><span class='line'>'-F/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS9.0.sdk/Developer/Library/Frameworks'</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ˜¯å› ä¸º Xcode7 å°† <code>Frameworks</code> ä½ç½®æ”¹å˜äº†ã€‚</p>

<!--more-->


<p>ç‚¹å‡»é¡¹ç›®ï¼Œé€‰æ‹© TARGETS ä¸­çš„å·¥ç¨‹å Testsï¼Œç„¶åé€‰æ‹© Build Settingsï¼Œåœ¨ Search Paths ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶ <code>Framework Search Paths</code> è·¯å¾„ï¼Œæ­¤è·¯å¾„ä¸ºé”™è¯¯è·¯å¾„ã€‚</p>

<p><img src="http://i3.tietuku.com/40d46fe638434b1e.png" alt="" /></p>

<p>åŒå‡»è·¯å¾„ï¼Œåˆ é™¤ <code>$(SDKROOT)/Developer/Library/Frameworks</code>ï¼Œå¢åŠ  <code>$(PLATFORM_DIR)/Developer/Library/Frameworks</code>ï¼Œæ­¤æ—¶è·¯å¾„å°±å·²ç»ä¿®æ”¹æˆåŠŸã€‚</p>

<p><img src="http://i3.tietuku.com/6b824df6fd5bc002.png" alt="" /></p>

<p>ä¿®æ”¹å®Œæˆä¹‹åï¼Œé‡æ–°ç¼–è¯‘é¡¹ç›®ï¼Œæ­¤è­¦å‘Šå°±ä¿®å¤äº†ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[App Transport Security]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/09/21/ios9-gua-pei/"/>
    <updated>2015-09-21T23:37:59+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/09/21/ios9-gua-pei</id>
    <content type="html"><![CDATA[<p><code>App Transport Security</code> æ˜¯ä¸€é¡¹æ–°çš„åŠŸèƒ½ï¼Œç”¨æ¥æé«˜äº†åº”ç”¨ç¨‹åºå’Œ <code>web</code> æœåŠ¡ä¹‹é—´è¿æ¥çš„å®‰å…¨æ€§ã€‚è¿™é¡¹åŠŸèƒ½æ˜¯ä» iOS9.0 å’Œ OSX10.11 ä¹‹åè‹¹æœæ–°å¢çš„ï¼Œè¦æ±‚é»˜è®¤è¿æ¥æœ€å¥½æ˜¯å®‰å…¨çš„è¿æ¥ã€‚å½“ç„¶ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å…³é—­è¿™é¡¹åŠŸèƒ½ã€‚</p>

<h4>é»˜è®¤é…ç½®</h4>

<p>ä¸º iOS9.0 å’Œ OSX10.11 åŠä¹‹åç‰ˆæœ¬çš„å¼€å‘çš„ appsï¼Œç”¨åˆ° <code>NSURLConnection</code>ï¼Œ<code>CFURL</code> æˆ–è€… <code>NSURLSession</code> API çš„æ‰€æœ‰è¿æ¥ï¼Œå°†ä½¿ç”¨ <code>App Transport Security</code> é»˜è®¤é…ç½®ã€‚</p>

<!--more-->


<p>&ndash; æœªå®Œå¾…ç»­ &ndash;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[KVC çš„ç®€å•ä½¿ç”¨]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/09/12/kvcde-jian-dan-shi-yong/"/>
    <updated>2015-09-12T22:58:12+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/09/12/kvcde-jian-dan-shi-yong</id>
    <content type="html"><![CDATA[<h2>KVC å­—å…¸è½¬æ¨¡å‹</h2>

<ul>
<li>KVC ä¸­ç»å¸¸ä½¿ç”¨çš„å°±æ˜¯å­—å…¸è½¬æ¨¡å‹</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// NSObject(NSKeyValueCoding) NSObject çš„åˆ†ç±»</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setValuesForKeysWithDictionary:</span><span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">keyedValues</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>




<!--more-->


<p><img src="http://i1.tietuku.com/cc3c54dccb414089.png" alt="å­—å…¸è½¬æ¨¡å‹" /></p>

<hr />

<h2>KVC çš„å¤§æ‹›</h2>

<ul>
<li>KVC è®¾ç½®å¯¹è±¡å±æ€§åŠå–å€¼</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setValue:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">value</span> <span class="nf">forKey:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">valueForKey:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">key</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://i2.tietuku.com/4d55944da6a1bcf7.png" alt="LNPersonç±»çš„å¤´æ–‡ä»¶" />
<img src="http://i1.tietuku.com/12c24aeb2ed198ac.png" alt="KVCè®¾ç½®å¯¹è±¡å±æ€§åŠå–å€¼" /></p>

<ul>
<li>KVC é—´æ¥è®¾ç½®å¯¹è±¡å±æ€§

<ul>
<li>åœ¨è¿è¡Œçš„æ—¶å€™ï¼ŒKVC å¯ä»¥é—´æ¥è®¾ç½®å¯¹è±¡çš„å±æ€§ï¼Œä¸ç®¡å¯¹è±¡å±æ€§æ˜¯å¦åœ¨ <code>.h</code> ä¸­å…¬å¼€ï¼Œå½“ç„¶è¿™è¿èƒŒé¢å‘å¯¹è±¡è®¾è®¡çš„ <strong>å¼€é—­åŸåˆ™</strong>ï¼Œä¸¥é‡ä¸å»ºè®®åœ¨ç¨‹åºå¼€å‘ä¸­ä½¿ç”¨ã€‚</li>
</ul>
</li>
</ul>


<p><img src="http://i1.tietuku.com/ec730d8853185ebc.png" alt="LNPersonç±»çš„.mæ–‡ä»¶" />
<img src="http://i1.tietuku.com/b5dba559d850fe72.png" alt="KVCé—´æ¥è®¾ç½®å¯¹è±¡å±æ€§" /></p>

<hr />

<h2>KVC æ¨¡å‹è½¬å­—å…¸</h2>

<ul>
<li>KVC æ¨¡å‹è½¬å­—å…¸

<ul>
<li>KVC æ¨¡å‹è½¬å­—å…¸ï¼Œå‚æ•°æ˜¯å±æ€§åç§°çš„æ•°ç»„ã€‚</li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// keys æ˜¯å±æ€§åç§°çš„æ•°ç»„</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nf">dictionaryWithValuesForKeys:</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">keys</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://i2.tietuku.com/8b2fb0382d0bce99.png" alt="KVCæ¨¡å‹è½¬å­—å…¸" /></p>

<hr />

<h2>KVC æ ¸å¿ƒåŠ¨ç”»</h2>

<ul>
<li>KVC æœ€ç»å…¸çš„åº”ç”¨â€”â€”æ ¸å¿ƒåŠ¨ç”»

<ul>
<li>é€šè¿‡ KVC è®¾ç½®åŠ¨ç”»çš„ <code>KeyPath</code>ï¼Œåœ¨å®ä¾‹åŒ–åŠ¨ç”»çš„æ—¶å€™ï¼ŒæŒ‡å®šå›¾å±‚çš„å¯åŠ¨ç”»å±æ€§ã€‚</li>
</ul>
</li>
</ul>


<p><img src="http://i1.tietuku.com/2df35a7c17406ce3.png" alt="" />
<img src="http://i1.tietuku.com/1545fe7a18db2738.gif" alt="æ ¸å¿ƒåŠ¨ç”»" /></p>

<hr />
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Block çš„ç®€å•ä½¿ç”¨]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/09/10/block-de-jian-dan-shi-yong/"/>
    <updated>2015-09-10T23:42:34+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/09/10/block-de-jian-dan-shi-yong</id>
    <content type="html"><![CDATA[<h3>Block çš„ä»‹ç»</h3>

<ul>
<li>å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„é€šä¿¡æ–¹å¼

<ol>
<li><strong>ä»£ç†-åè®®</strong>ï¼Œ<strong>é€šçŸ¥</strong>ï¼Œ<strong>Block</strong>ã€‚</li>
<li>ä¸‰ç§é€šä¿¡æ–¹å¼éƒ½å®ç°äº†å¯¹è±¡ä¹‹é—´çš„è§£è€¦åˆã€‚</li>
<li>é€šçŸ¥çš„é€šä¿¡æ–¹å¼æ˜¯ <strong>1å¯¹å¤š</strong>ã€‚</li>
<li>ä»£ç†ã€Block æ˜¯ <strong>1å¯¹1</strong>ã€‚</li>
</ol>
</li>
</ul>


<p></p>


<ul>
<li>Block ä»‹ç»

<ol>
<li>Block æ˜¯ iOS4.0 ä¹‹åæ–°å¢çš„ä¸€ç§è¯­æ³•ç»“æ„ï¼Œä¹Ÿç§°ä¸ºâ€œé—­åŒ…â€ã€‚</li>
<li>Block æ˜¯ä¸€ä¸ªåŒ¿åçš„å‡½æ•°ä»£ç å—ï¼Œæ­¤ä»£ç å—å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å¯¹è±¡ã€‚</li>
<li>å¯ä»¥æŠŠ block å½“åš Objective-C çš„åŒ¿åå‡½æ•°ï¼Œblock æ˜¯ OC ä¸­çš„ä¸€ç§æ•°æ®ç±»å‹ï¼Œ<code>^</code>æ˜¯ block çš„ç‰¹æœ‰æ ‡è®°ã€‚</li>
</ol>
</li>
</ul>


<p></p>


<ul>
<li>Block æ ¼å¼è¯´æ˜

<ol>
<li><code>(è¿”å›ç±»å‹)(^blockåç§°)(å‚æ•°ç±»å‹)=^(å‚æ•°åˆ—è¡¨){ä»£ç å®ç°};</code>ã€‚</li>
<li>å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œç­‰å·åé¢å‚æ•°åˆ—è¡¨çš„()å¯ä»¥çœç•¥ã€‚</li>
</ol>
</li>
</ul>


<p></p>




<!--more-->


<h3>Block çš„ä½¿ç”¨</h3>

<ul>
<li>Block çš„å®šä¹‰</li>
</ul>


<p><img src="http://i2.tietuku.com/4a270839c9929017.png" alt="å®šä¹‰Blockçš„å¸¸è§ä¸¤ç§æ–¹å¼" /></p>

<ul>
<li>Block çš„3ç§ç±»å‹

<ol>
<li>ä¸ç®¡åœ¨ ARC è¿˜æ˜¯ MRC ç¯å¢ƒä¸‹ï¼Œblock å†…éƒ¨å¦‚æœæ²¡æœ‰è®¿é—®å¤–éƒ¨å˜é‡ï¼Œè¿™ä¸ª block æ˜¯ <strong>å…¨å±€ block</strong> <code>__NSGlobalBlock__</code>ï¼Œå½¢å¼ç±»ä¼¼å‡½æ•°ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ <strong>ä»£ç åŒº</strong>ã€‚</li>
<li>åœ¨ <strong>MRC</strong> ä¸‹ï¼Œblock å†…éƒ¨å¦‚æœè®¿é—®å¤–éƒ¨å˜é‡ï¼Œè¿™ä¸ª block æ˜¯ <strong>æ ˆ block</strong> <code>__NSStackBlock__</code>ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ <strong>æ ˆ</strong> ä¸Šã€‚</li>
<li>åœ¨ <strong>MRC</strong> ä¸‹ï¼Œblock å†…éƒ¨è®¿é—®å¤–éƒ¨å˜é‡ï¼ŒåŒæ—¶å¯¹è¯¥ block åšä¸€æ¬¡ <strong>copy æ“ä½œ</strong>ï¼Œè¿™ä¸ª block æ˜¯ <strong>å † block</strong> <code>__NSMallocBlock__</code>ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ <strong>å †</strong> ä¸Šã€‚</li>
<li>åœ¨ <strong>ARC</strong> ä¸‹ï¼Œblock å†…éƒ¨å¦‚æœè®¿é—®å¤–éƒ¨å˜é‡ï¼Œè¿™ä¸ª block æ˜¯ <strong>å † block</strong> <code>__NSMallocBlock__</code>ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ <strong>å †</strong> ä¸Šï¼Œå› ä¸ºåœ¨ ARC ä¸‹ï¼Œé»˜è®¤å¯¹ block åšäº†ä¸€æ¬¡ copy æ“ä½œã€‚</li>
</ol>
</li>
</ul>


<p><img src="http://i2.tietuku.com/8c06ba2fe062559a.png" alt="å…¨å±€block" />
<img src="http://i2.tietuku.com/bb203edf923cea6b.png" alt="æ ˆblock" />
<img src="http://i2.tietuku.com/5c461733e51097cd.png" alt="å †block" /></p>

<ul>
<li>Block ä½œä¸ºæ–¹æ³•çš„å‚æ•°

<ul>
<li>å°† block ä½œä¸ºæ–¹æ³•çš„å‚æ•°ï¼Œå¯ä»¥ç”¨ block æ¥å°è£…ä»£ç å—ã€‚</li>
</ul>
</li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/9491566bjw1erczgvtdkdj211i0d2aep.jpg" alt="blockä½œä¸ºæ–¹æ³•çš„å‚æ•°" /></p>

<ul>
<li>Block ä½œä¸ºå±æ€§</li>
</ul>


<p><img src="http://ww4.sinaimg.cn/large/9491566bjw1ercziuw0btj21420hin58.jpg" alt="blockä½œä¸ºå±æ€§" /></p>

<ul>
<li>Block çš„æ–¹å¼éå†æ•°ç»„\å­—å…¸</li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/9491566bjw1erd0j2s7stj213s0l2qfl.jpg" alt="blockçš„æ–¹å¼éå†æ•°ç»„\å­—å…¸" /></p>

<h3>Block çš„ä½¿ç”¨æ³¨æ„</h3>

<ul>
<li>Block è®¿é—®å¤–éƒ¨å˜é‡

<ol>
<li>block å†…éƒ¨å¯ä»¥è®¿é—®å¤–éƒ¨çš„å˜é‡ï¼Œblock é»˜è®¤æ˜¯å°†å…¶å¤åˆ¶åˆ°å…¶æ•°æ®ç»“æ„ä¸­æ¥å®ç°è®¿é—®çš„ã€‚</li>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œblock å†…éƒ¨ä¸èƒ½ä¿®æ”¹å¤–é¢çš„å±€éƒ¨å˜é‡ï¼Œå› ä¸ºé€šè¿‡ block è¿›è¡Œé—­åŒ…çš„å˜é‡æ˜¯ const çš„ã€‚</li>
<li>ç»™å±€éƒ¨å˜é‡åŠ ä¸Š <code>__block</code> å…³é”®å­—ï¼Œè¿™ä¸ªå±€éƒ¨å˜é‡å°±å¯ä»¥åœ¨ block å†…éƒ¨ä¿®æ”¹ï¼Œblock æ˜¯å¤åˆ¶å…¶å¼•ç”¨åœ°å€æ¥å®ç°è®¿é—®çš„ã€‚</li>
</ol>
</li>
</ul>


<p><img src="http://ww2.sinaimg.cn/large/9491566bjw1erdasuqz67j216s0kqtl6.jpg" alt="blockè®¿é—®å¤–éƒ¨å˜é‡" /></p>

<ul>
<li>Block ä½œä¸ºå±æ€§åº”è¯¥ç”¨ copy ä¿®é¥°

<ol>
<li>å½“ç”¨ weakã€assign ä¿®é¥° block å±æ€§æ—¶ï¼Œblock è®¿é—®å¤–éƒ¨å˜é‡ï¼Œæ­¤æ—¶ block çš„ç±»å‹æ˜¯ <strong>æ ˆ block</strong>ã€‚ä¿å­˜åœ¨æ ˆä¸­çš„ blockï¼Œå½“ block æ‰€åœ¨å‡½æ•°\æ–¹æ³•è¿”å›\ç»“æŸï¼Œè¯¥ block å°±ä¼šè¢«é”€æ¯ã€‚åœ¨å…¶ä»–æ–¹æ³•å†…éƒ¨è°ƒç”¨è®¿é—®è¯¥ blockï¼Œå°±ä¼šå¼•å‘é‡æŒ‡é’ˆé”™è¯¯ <code>EXC_BAD_ACCESS</code>ã€‚</li>
<li>å½“ç”¨ copyã€strong ä¿®é¥° block å±æ€§æ—¶ï¼Œblock è®¿é—®å¤–éƒ¨å˜é‡ï¼Œæ­¤æ—¶ block çš„ç±»å‹æ˜¯ <strong>å † block</strong>ã€‚ä¿å­˜åœ¨å †ä¸­çš„ blockï¼Œå½“å¼•ç”¨è®¡æ•°å™¨ä¸º0æ—¶è¢«é”€æ¯ï¼Œè¯¥ç±»å‹ block æ˜¯ç”±æ ˆç±»å‹çš„ block ä»æ ˆä¸­å¤åˆ¶åˆ°å †ä¸­å½¢æˆçš„ï¼Œå› æ­¤å¯ä»¥åœ¨å…¶ä»–æ–¹æ³•å†…éƒ¨è°ƒç”¨è¯¥ blockã€‚åœ¨ ARC ä¸‹ï¼Œ<code>strong</code> å’Œ <code>copy</code> éƒ½å¯ä»¥ç”¨æ¥ä¿®é¥° blockï¼Œä½†æ˜¯å»ºè®®ä¿®é¥° block å±æ€§ä½¿ç”¨ <code>copy</code>ã€‚</li>
</ol>
</li>
</ul>


<p><img src="http://ww1.sinaimg.cn/large/9491566bjw1erdce4hllbj21kw0j2qc7.jpg" alt="weakä¿®é¥°block" /></p>

<p><img src="http://ww4.sinaimg.cn/large/9491566bjw1erdfvoacrfj214i0jmqbu.jpg" alt="copyä¿®é¥°block" /></p>

<p>æ¨èé˜…è¯»ï¼š<a href="http://www.cocoachina.com/ios/20150109/10891.html">Objective-Cä¸­çš„Block</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS8 ä»¥ä¸Šå®šä½é—®é¢˜<äºŒ>]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/08/30/ios8xia-ding-wei-wen-ti-er/"/>
    <updated>2015-08-30T00:19:06+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/08/30/ios8xia-ding-wei-wen-ti-er</id>
    <content type="html"><![CDATA[<p>æ¥ä¸Šç¯‡ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åœ¨ç³»ç»Ÿç‰ˆæœ¬ iOS8 ä»¥ä¸Šå®Œæˆå®šä½åŠŸèƒ½ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªæ½œåœ¨ bug å­˜åœ¨ã€‚</p>

<p>è¿›å…¥è®¾ç½®åº”ç”¨ï¼Œå¾€ä¸‹æ»‘åŠ¨æ‰¾åˆ°è‡ªå·±çš„ appï¼Œè¿›å…¥ï¼Œç‚¹å‡» <strong>ä½ç½®</strong> å•å…ƒæ ¼ï¼Œè®¾ç½®åº”ç”¨ä¼šå½»åº•å¥”æºƒï¼Œå›åˆ°æ¡Œé¢äº†ã€‚</p>

<!--more-->


<p><img src="http://i3.tietuku.com/8d9493bef4f6a786.png" alt="ç‚¹å‡»ä½ç½®å´©æºƒ" /></p>

<p>ç»è¿‡ä¸€ç•ª Google å’Œ Stack Overflow åï¼Œé—®é¢˜å°±å‡ºç°åœ¨ <code>info.plist</code> æ–‡ä»¶ä¸­çš„ä¸¤ä¸ªç¼ºçœå­—æ®µã€‚</p>

<p>åœ¨ä¸Šä¸€ç¯‡åšå®¢ä¸­ï¼Œæˆ‘å°† <code>NSLocationWhenInUseUsageDescription</code> å’Œ <code>NSLocationAlwaysUsageDescription</code> çš„ç±»å‹è®¾ç½®ä¸º <code>Boolean</code>ï¼Œå€¼è®¾ç½®ä¸º <code>YES</code>ï¼Œè€Œæ­£ç¡®åšæ³•æ˜¯ç±»å‹è®¾ç½®ä¸º <code>String</code>ï¼Œå€¼å¡«å†™ä¸€äº›æè¿°ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šè¯·ç‚¹å‡»å…è®¸ä»¥å…è®¸è®¿é—®ï¼Œè‹¥ä¸å…è®¸å°†æ— æ³•ä½¿ç”¨ XX åŠŸèƒ½ã€‚è¿™é‡Œé¢æ‰€å¡«å†™çš„æ–‡å­—ï¼Œä¹Ÿä¼šè‡ªåŠ¨å‡ºç°åœ¨ä½ç½®é¡µé¢çš„åº”ç”¨ç¨‹åºè¯´æ˜ä¹‹åã€‚</p>

<p><img src="http://i3.tietuku.com/3881905e46802e76.png" alt="åº”ç”¨ç¨‹åºè¯´æ˜" /></p>

<p>å®Œæˆä¹‹åï¼Œé‡æ–°ç¼–è¯‘è¿è¡Œï¼Œå†å»è®¾ç½®é‚£ï¼Œæ€ä¹ˆç‚¹éƒ½ä¸ä¼šå´©æºƒäº†ï¼Overï¼</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOS8 ä»¥ä¸Šå®šä½é—®é¢˜<ä¸€>]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/07/16/ios8xia-ding-wei-wen-ti/"/>
    <updated>2015-07-16T16:50:38+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/07/16/ios8xia-ding-wei-wen-ti</id>
    <content type="html"><![CDATA[<p>Xcode6 ä¸‹ï¼Œå¯¹äºç³»ç»Ÿç‰ˆæœ¬ iOS8 ä»¥ä¸Šç‰ˆæœ¬å®šä½éœ€è¦è‡ªå·±å†™æˆæƒï¼Œä¸ç„¶æ²¡æœ‰æƒé™å®šä½ï¼Œå³ <code>CLLocationManagerDelegate</code> ä»£ç†æ–¹æ³•ä¸ä¼šæ‰§è¡Œã€‚</p>

<!--more-->


<p>è§£å†³æ–¹æ³•ï¼š</p>

<p>æ­¥éª¤ä¸€ï¼šéœ€è¦åœ¨ <code>info.plist</code> æ–‡ä»¶ä¸­åŠ å…¥ä¸‹é¢ä¸¤ä¸ªç¼ºçœå­—æ®µï¼Œå€¼è®¾ç½®ä¸º <code>YES</code>ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">NSLocationWhenInUseUsageDescription</span> <span class="c1">// å…è®¸åœ¨å‰å°è·å– GPS çš„æè¿°</span>
</span><span class='line'><span class="n">NSLocationAlwaysUsageDescription</span> <span class="c1">// å…è®¸åœ¨å‰ã€åå°è·å– GPS çš„æè¿° </span>
</span></code></pre></td></tr></table></div></figure>


<p>æ­¥éª¤äºŒï¼šåˆ¤æ–­è®¾å¤‡ç³»ç»Ÿç‰ˆæœ¬ï¼Œå¦‚æœç³»ç»Ÿç‰ˆæœ¬å¤§äº8.0ï¼Œè®¾ç½®å®šä½æƒé™ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="cp">#import &quot;ViewController.h&quot;</span>
</span><span class='line'><span class="cp">#import &lt;CoreLocation/CoreLocation.h&gt;</span>
</span><span class='line'><span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span><span class="o">&lt;</span><span class="bp">CLLocationManagerDelegate</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">@property</span> <span class="p">(</span><span class="k">nonatomic</span><span class="p">,</span> <span class="k">strong</span><span class="p">)</span> <span class="bp">CLLocationManager</span> <span class="o">*</span><span class="n">locationManager</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ViewController</span>
</span><span class='line'><span class="c1">// æ‡’åŠ è½½åˆå§‹åŒ– self.locationManager</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="bp">CLLocationManager</span> <span class="o">*</span><span class="p">)</span><span class="nf">locationManager</span><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">_locationManager</span><span class="p">){</span>
</span><span class='line'>        <span class="n">_locationManager</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">CLLocationManager</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>        <span class="n">_locationManager</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">_locationManager</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// è°ƒç”¨è¯·æ±‚</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">([[[</span><span class="bp">UIDevice</span> <span class="n">currentDevice</span><span class="p">]</span> <span class="n">systemVersion</span><span class="p">]</span> <span class="n">doubleValue</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">8.0</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="c1">// è®¾ç½®å®šä½æƒé™ä»… iOS8 æœ‰æ„ä¹‰</span>
</span><span class='line'>        <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">locationManager</span> <span class="n">requestWhenInUseAuthorization</span><span class="p">];</span> <span class="c1">// å‰å°å®šä½</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// [locationManager requestAlwaysAuthorization]; // å‰åå°åŒæ—¶å®šä½</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">locationManager</span> <span class="n">startUpdatingLocation</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ä»£ç†æ–¹æ³•</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">locationManager:</span><span class="p">(</span><span class="bp">CLLocationManager</span> <span class="o">*</span><span class="p">)</span><span class="nv">manager</span> <span class="nf">didUpdateLocations:</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">locations</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%zd&quot;</span><span class="p">,</span> <span class="n">locations</span><span class="p">.</span><span class="n">count</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<p>è‡³æ­¤ï¼ŒiOS8 ä¸‹å®šä½é—®é¢˜å°±å¯ä»¥è§£å†³äº†ï¼</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è‡ªå®šä¹‰è½¬åœºåŠ¨ç”»ä»‹ç»(ç¿»è¯‘)]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/05/30/zi-ding-yi-zhuan-chang-dong-hua-jie-shao-fan-yi/"/>
    <updated>2015-05-30T21:37:02+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/05/30/zi-ding-yi-zhuan-chang-dong-hua-jie-shao-fan-yi</id>
    <content type="html"><![CDATA[<p><a href="http://www.appcoda.com/custom-view-controller-transitions-tutorial/">è‹±æ–‡åŸæ–‡åœ°å€</a></p>

<p>ä»”ç»†è§‚å¯Ÿ iOS è®¾å¤‡ä¸Šè‹¹æœå†…ç½®çš„ appï¼Œä½ ä¼šå‘ç°å„ç§è§†å›¾æ§åˆ¶å™¨è½¬åœºåŠ¨ç”»ã€‚iOS7 ä»‹ç»äº†è‡ªå®šä¹‰æ§åˆ¶å™¨è½¬åœºï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåœ¨ä»–ä»¬çš„åº”ç”¨ä¸­åˆ›å»ºè‡ªå·±çš„è½¬åœºåŠ¨ç”»ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬è¿˜å°†äº†è§£æ€æ ·é€šè¿‡æ‰‹åŠ¿è¿›è¡Œäº¤äº’å¼è½¬åœº <code>interactive transitions</code>ã€‚</p>

<!--more-->


<p><img src="http://i1.tietuku.com/41b836336adda5e8.jpg" alt="" /></p>

<h2>å¼€å§‹</h2>

<p>åˆ›å»ºè‡ªå®šä¹‰è½¬åœºå¿…é¡»éµå¾ªä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š</p>

<ol>
<li>åˆ›å»ºä¸€ä¸ªç±»ï¼Œéµå®ˆ <code>UIViewControllerAnimatedTransitioning</code> åè®®ï¼Œå¹¶å®ç°åè®®ä¸­çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼Œå°†ç¼–å†™æ‰§è¡ŒåŠ¨ç”»çš„ä»£ç ï¼Œè¿™ä¸ªç±»è¢«ç”¨åšåŠ¨ç”»æ§åˆ¶å™¨ã€‚</li>
<li>åœ¨ <code>present</code> æ§åˆ¶å™¨å‰ï¼Œéœ€è®¾ç½®ä¸€ä¸ªç±»ä½œä¸ºå…¶è½¬åœºä»£ç†ã€‚è¿™ä¸ªä»£ç†ç”¨äºå½“ <code>present</code> æ§åˆ¶å™¨æ—¶ï¼Œä»åŠ¨ç”»æ§åˆ¶å™¨ä¸­å›è°ƒã€‚</li>
<li>å®ç°å›è°ƒæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªç¬¬ä¸€æ­¥ä¸­çš„åŠ¨ç”»æ§åˆ¶å™¨å®ä¾‹å¯¹è±¡ã€‚</li>
</ol>


<p>è¿è¡Œåˆå§‹é¡¹ç›®ä½ ä¼šçœ‹åˆ°ä¸€ç»„ items çš„ tableViewï¼Œåœ¨å¯¼èˆªæ å³è¾¹æœ‰ä¸€ä¸ª <code>Action</code> æŒ‰é’®ï¼Œå½“ä½ ç‚¹å‡»å®ƒï¼Œä¼šä»¥é»˜è®¤ <code>modal</code> æ ·å¼ä»åº•éƒ¨ <code>present</code> å‡ºä¸€ä¸ªæ§åˆ¶å™¨ï¼Œæˆ‘ä»¬å°†ä¸ºè¿™ä¸ªè§†å›¾è½¬åœºç¼–å†™è‡ªå®šä¹‰è½¬åœºã€‚</p>

<p><img src="http://i1.tietuku.com/86214a9a01cf1d06.gif" alt="" /></p>

<h2>è‡ªå®šä¹‰ Present è½¬åœº</h2>

<p>å¦‚å‰æ‰€è¿°ï¼Œæ¥ä¸‹æ¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ›å»ºåŠ¨ç”»æ§åˆ¶å™¨ã€‚åˆ›å»ºä¸€ä¸ª <code>CustomPresentAnimationController</code> ç±»ç»§æ‰¿è‡ª <code>NSObject</code>ï¼Œå¹¶éµå®ˆ <code>UIViewControllerAnimatedTransitioning</code> åè®®ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">CustomPresentAnimationController</span><span class="p">:</span> <span class="bp">NSObject</span><span class="p">,</span> <span class="bp">UIViewControllerAnimatedTransitioning</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>UIViewControllerAnimatedTransitioning</code> åè®®æœ‰ä¸¤ä¸ªå¿…é¡»å®ç°çš„æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">åŠ¨ç”»æŒç»­æ—¶é—´</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="k">func</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="nl">transitionContext</span><span class="p">:</span> <span class="bp">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NSTimeInterval</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="mf">2.5</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">è½¬åœºåŠ¨ç”»</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="k">func</span> <span class="n">animateTransition</span><span class="p">(</span><span class="nl">transitionContext</span><span class="p">:</span> <span class="bp">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">fromViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">viewControllerForKey</span><span class="p">(</span><span class="n">UITransitionContextFromViewControllerKey</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">toViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">viewControllerForKey</span><span class="p">(</span><span class="n">UITransitionContextToViewControllerKey</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">finalFrameForVC</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">finalFrameForViewController</span><span class="p">(</span><span class="n">toViewController</span><span class="p">)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">containerView</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">containerView</span><span class="p">()</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">bounds</span> <span class="o">=</span> <span class="bp">UIScreen</span><span class="p">.</span><span class="n">mainScreen</span><span class="p">().</span><span class="n">bounds</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// è®¾ç½®ç›®æ ‡æ§åˆ¶å™¨çš„ frame</span>
</span><span class='line'>    <span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectOffset</span><span class="p">(</span><span class="n">finalFrameForVC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bounds</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
</span><span class='line'>    <span class="c1">// å°†ç›®æ ‡æ§åˆ¶å™¨çš„æ ¹ view æ·»åŠ è‡³å®¹å™¨è§†å›¾ containerView</span>
</span><span class='line'>    <span class="n">containerView</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// è®¾ç½®åŠ¨ç”»ä»£ç </span>
</span><span class='line'>    <span class="bp">UIView</span><span class="p">.</span><span class="n">animateWithDuration</span><span class="p">(</span><span class="n">transitionDuration</span><span class="p">(</span><span class="n">transitionContext</span><span class="p">),</span> <span class="nl">delay</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="nl">usingSpringWithDamping</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nl">initialSpringVelocity</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">options</span><span class="p">:</span> <span class="n">UIViewAnimationOptions</span><span class="p">.</span><span class="n">CurveLinear</span><span class="p">,</span> <span class="nl">animations</span><span class="p">:</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span class='line'>        <span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">finalFrameForVC</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">in</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// åŠ¨ç”»ç»“æŸå é€šçŸ¥è½¬åœºä¸Šä¸‹æ–‡è½¬åœºç»“æŸ</span>
</span><span class='line'>        <span class="n">transitionContext</span><span class="p">.</span><span class="n">completeTransition</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
</span><span class='line'>        <span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç¬¬ä¸€æ–¹æ³•æ˜¯è®¾ç½®è½¬åœº<em>åŠ¨ç”»æ—¶é•¿</em>ï¼Œè¿™ä¸ª Demo ä¸­æˆ‘ä»¬è®¾ç½®2.5ç§’ï¼Œä½†æ˜¯åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ åº”è¯¥è®¾ç½®ä¸€ä¸ªæ¯”è¿™ä¸ªæ•°å°çš„æ•°ã€‚</p>

<p>ç¬¬äºŒä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬é€šè¿‡è½¬åœºä¸Šä¸‹æ–‡ <code>transitionContext</code> å–å¾—<em>æ¥æºæ§åˆ¶å™¨</em> fromVCã€<em>ç›®æ ‡æ§åˆ¶å™¨</em> toVCã€åŠ¨ç”»ç»“æŸåç»ˆæ­¢ frameï¼Œä»¥åŠç»™ fromVC å’Œ toVC è½¬åœºåˆ‡æ¢è§†å›¾æä¾›å®¹å™¨çš„<em>å®¹å™¨è§†å›¾</em> <code>containerView</code>ã€‚</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬è®¾ç½® toView åœ¨å±å¹•çš„åº•éƒ¨ï¼Œç„¶åå°† toView æ·»åŠ è‡³å®¹å™¨è§†å›¾å’ŒåŠ¨ç”»çš„é—­åŒ…ä¸­ï¼Œè®© toView åŠ¨ç”»è‡³è®¾å®šçš„æœ€ç»ˆä½ç½®ã€‚åŒæ—¶ä¹Ÿè®¾ç½®äº† fromView çš„é€æ˜åº¦åŠ¨ç”»ï¼Œä»¥è‡³äºéšç€ toView çš„å‘ä¸Šæ»‘åŠ¨ fromView é€æ¸æ·¡å‡ºã€‚åŠ¨ç”»æ—¶é—´é€šè¿‡ <code>transitionDuration(transitionContext)</code> è·å¾—ã€‚åœ¨å®Œæˆé—­åŒ…ä¸­ï¼Œæˆ‘ä»¬é€šçŸ¥è½¬åœºä¸Šä¸‹æ–‡è½¬åœºç»“æŸï¼Œæ¥ç€è®© fromView çš„é€æ˜åº¦æ¢å¤æ­£å¸¸ã€‚å®¹å™¨è§†å›¾å°†ä¼šç§»é™¤ fromViewã€‚</p>

<p>åŠ¨ç”»æ§åˆ¶å™¨ç±»é‡Œé¢çš„ä»»åŠ¡å·²ç»å®Œæˆï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬éœ€è¦å°†å®ƒå’Œ <code>storyboard segue</code> è¿æ¥èµ·æ¥ã€‚</p>

<p>æ‰“å¼€ ItemsTableViewController.swift æ–‡ä»¶ï¼Œéµå®ˆ <code>UIViewControllerTransitioningDelegate</code> åè®®ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">ItemsTableViewController</span><span class="p">:</span> <span class="bp">UITableViewController</span><span class="p">,</span> <span class="bp">UIViewControllerTransitioningDelegate</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>UIViewController æœ‰ä¸€ä¸ª <code>transitionDelegate</code> å±æ€§ï¼Œæ”¯æŒè‡ªå®šä¹‰è½¬åœºã€‚å½“è½¬åœºè‡³ä¸€ä¸ªæ§åˆ¶å™¨æ—¶ï¼Œä¼šé€šè¿‡è¿™ä¸ªå±æ€§æŸ¥çœ‹è‡ªå®šä¹‰è½¬åœºæ˜¯å¦ä½¿ç”¨ã€‚<code>UIViewControllerTransitioningDelegate</code> æä¾›è‡ªå®šä¹‰è½¬åœºã€‚</p>

<p>æ‰“å¼€ Main.storyboard æ–‡ä»¶ï¼Œé€‰æ‹© <code>Present modally segue to Action View Controller</code>ï¼Œåœ¨å±æ€§æ£€æŸ¥å™¨ä¸­ï¼Œè®¾ç½®å®ƒçš„ Identifier ä¸º <code>showAction</code>ã€‚</p>

<p><img src="http://i1.tietuku.com/f710e825b83b99be.png" alt="" /></p>

<p>å›åˆ° ItemsTableViewController.swift æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">/// å®ä¾‹åŒ–ä¸€ä¸ª Present åŠ¨ç”»æ§åˆ¶å™¨</span>
</span><span class='line'><span class="k">let</span> <span class="n">customPresentAnimationController</span> <span class="o">=</span> <span class="n">CustomPresentAnimationController</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="n">prepareForSegue</span><span class="p">(</span><span class="nl">segue</span><span class="p">:</span> <span class="bp">UIStoryboardSegue</span><span class="p">,</span> <span class="nl">sender</span><span class="p">:</span> <span class="n">AnyObject</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span>  <span class="n">segue</span><span class="p">.</span><span class="n">identifier</span> <span class="o">==</span> <span class="s">&quot;showAction&quot;</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">let</span> <span class="n">toViewController</span> <span class="o">=</span> <span class="n">segue</span><span class="p">.</span><span class="n">destinationViewController</span> <span class="kt">as</span><span class="o">!</span> <span class="bp">UIViewController</span>
</span><span class='line'>        <span class="c1">// è®¾ç½®ç›®æ ‡æ§åˆ¶å™¨çš„è½¬åœºä»£ç†ä¸ºå½“å‰æ§åˆ¶å™¨</span>
</span><span class='line'>        <span class="n">toViewController</span><span class="p">.</span><span class="n">transitioningDelegate</span> <span class="o">=</span> <span class="nb">self</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨è¿™é‡Œæˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ª Present åŠ¨ç”»æ§åˆ¶å™¨ï¼Œåœ¨ <code>prepareForSegue()</code> å‡½æ•°ä¸­ï¼Œè®¾ç½®ç›®æ ‡æ§åˆ¶å™¨çš„ <code>transitioningDelegate</code> å±æ€§ã€‚</p>

<p>ç»§ç»­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œè¿”å›è‡ªå®šä¹‰ <code>Present</code> åŠ¨ç”»æ§åˆ¶å™¨å®ä¾‹å¯¹è±¡ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">è¿”å›è‡ªå®šä¹‰ Present åŠ¨ç”»å¯¹è±¡</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="k">func</span> <span class="n">animationControllerForPresentedController</span><span class="p">(</span><span class="nl">presented</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">,</span> <span class="n">presentingController</span> <span class="nl">presenting</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">,</span> <span class="n">sourceController</span> <span class="nl">source</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">UIViewControllerAnimatedTransitioning</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">customPresentAnimationController</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿è¡Œç¨‹åºï¼Œä½ ä¼šçœ‹åˆ°ä¸‹å›¾æ•ˆæœï¼ŒAction view åœ¨å±å¹•åº•éƒ¨å‘ä¸Šç¼“æ…¢æ»‘åŠ¨ï¼Œåœæ­¢å‰ä¼šæœ‰å°çš„å¼¹ç°§æ•ˆæœã€‚</p>

<p><img src="http://i1.tietuku.com/ca3edd567594f674.gif" alt="" /></p>

<p>åœ¨ CustomPresentAnimationController.swift æ›´æ”¹ä»£ç å¦‚ä¸‹ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªç¨å¾®ä¸åŒçš„æ•ˆæœï¼Œç›®æ ‡æ§åˆ¶å™¨çš„åˆå§‹ä½ç½®æ˜¯åœ¨å±å¹•ä¸Šæ–¹ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectOffset</span><span class="p">(</span><span class="n">finalFrameForVC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">bounds</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿è¡Œç¨‹åºï¼Œè¿™æ¬¡ Action view æ˜¯ä»å±å¹•é¡¶éƒ¨ç¼“æ…¢è½ä¸‹ã€‚</p>

<h2>è‡ªå®šä¹‰ Dismiss è½¬åœº</h2>

<p>æˆ‘ä»¬å·²ç»å®ç°äº†è‡ªå®šä¹‰ <code>present</code> è½¬åœºåŠ¨ç”»ï¼Œä½†æ˜¯ <code>dismiss</code> è½¬åœºåŠ¨ç”»è¿˜æ˜¯ä½¿ç”¨çš„è‹¹æœé»˜è®¤çš„ã€‚</p>

<p><code>UIViewControllerTransitioningDelegate</code> åè®®å…è®¸åŒæ—¶è®¾ç½®è´Ÿè´£ <code>dismiss</code> å’Œ <code>present</code> æ§åˆ¶å™¨çš„è½¬åœºåŠ¨ç”»æ§åˆ¶å™¨ã€‚</p>

<p>åˆ›å»ºä¸€ä¸ª <code>CustomDismissAnimationController</code> ç±»ï¼Œç»§æ‰¿è‡ª <code>NSObject</code>ï¼Œå¹¶éµå®ˆ <code>UIViewControllerAnimatedTransitioning</code> åè®®ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">class</span> <span class="nl">CustomDismissAnimationController</span><span class="p">:</span> <span class="bp">NSObject</span><span class="p">,</span> <span class="bp">UIViewControllerAnimatedTransitioning</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨è¿™ä¸ªç±»æ·»åŠ å¦‚ä¸‹ä»£ç ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">åŠ¨ç”»æŒç»­æ—¶é—´</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="k">func</span> <span class="nf">transitionDuration</span><span class="p">(</span><span class="nl">transitionContext</span><span class="p">:</span> <span class="bp">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NSTimeInterval</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="mf">2.0</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">è½¬åœºåŠ¨ç”»</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="k">func</span> <span class="n">animateTransition</span><span class="p">(</span><span class="nl">transitionContext</span><span class="p">:</span> <span class="bp">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">fromViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">viewControllerForKey</span><span class="p">(</span><span class="n">UITransitionContextFromViewControllerKey</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">toViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">viewControllerForKey</span><span class="p">(</span><span class="n">UITransitionContextToViewControllerKey</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">finalFrameForVC</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">finalFrameForViewController</span><span class="p">(</span><span class="n">toViewController</span><span class="p">)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">containerView</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">containerView</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// è®¾ç½® toVC çš„æ ¹ view çš„ frame ä»¥åŠé€æ˜åº¦</span>
</span><span class='line'>    <span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">finalFrameForVC</span>
</span><span class='line'>    <span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span class='line'>    <span class="c1">// å°†ç›®æ ‡æ§åˆ¶å™¨çš„æ ¹ view æ·»åŠ è‡³å®¹å™¨è§†å›¾ containerView</span>
</span><span class='line'>    <span class="n">containerView</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">)</span>
</span><span class='line'>    <span class="n">containerView</span><span class="p">.</span><span class="n">sendSubviewToBack</span><span class="p">(</span><span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// è®¾ç½®åŠ¨ç”»ä»£ç </span>
</span><span class='line'>    <span class="bp">UIView</span><span class="p">.</span><span class="n">animateWithDuration</span><span class="p">(</span><span class="n">transitionDuration</span><span class="p">(</span><span class="n">transitionContext</span><span class="p">),</span> <span class="nl">animations</span><span class="p">:</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectInset</span><span class="p">(</span><span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>        <span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// åŠ¨ç”»ç»“æŸå é€šçŸ¥è½¬åœºä¸Šä¸‹æ–‡è½¬åœºç»“æŸ</span>
</span><span class='line'>        <span class="n">transitionContext</span><span class="p">.</span><span class="n">completeTransition</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ®µä»£ç å’Œ <code>present</code> è½¬åœºåŠ¨ç”»ä»£ç å®ç°æ–¹å¼å¾ˆç›¸ä¼¼ã€‚åœ¨ <code>animateTransition()</code> å‡½æ•°ä¸­ï¼Œæ‹¿åˆ°å½“å‰è½¬åœºä¸Šä¸‹æ–‡çš„ toVC å’Œ fromVCã€‚ç°åœ¨çš„ toVC æ˜¯è¡¨è§†å›¾æ§åˆ¶å™¨ï¼Œæˆ‘ä»¬è®¾ç½®äº†å®ƒçš„æ ¹è§†å›¾çš„ alpha å€¼ï¼ŒåŠ¨ç”»å¼€å§‹åï¼Œå°†é€æ¸æ·¡å…¥ã€‚ç„¶åå°† toVC çš„æ ¹ view æ·»åŠ è‡³å®¹å™¨è§†å›¾ï¼Œå¹¶æ”¾åœ¨ fromVC çš„æ ¹ view çš„åé¢ã€‚</p>

<p>åœ¨åŠ¨ç”»é—­åŒ…ä¸­ï¼Œè®¾ç½®äº† fromVC çš„æ ¹ view çš„å®½å’Œé«˜åŠ¨ç”»åˆ°0ï¼Œå¹¶ä¿æŒåœ¨å±å¹•çš„ä¸­å¿ƒï¼Œè¿™ä¼šäº§ç”Ÿä¸€ä¸ª from view ç¼©å°åˆ°æ¶ˆå¤±çš„åŠ¨ç”»æ•ˆæœï¼ŒåŒæ—¶ to view é€æ¸å¯è§ã€‚</p>

<p>åœ¨ ItemsTableViewController.swift æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢è¿™ä¸ªå±æ€§ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">/// å®ä¾‹åŒ–ä¸€ä¸ªè´Ÿè´£ Dismiss è½¬åœºåŠ¨ç”»æ§åˆ¶å™¨</span>
</span><span class='line'><span class="k">let</span> <span class="n">customDismissAnimationController</span> <span class="o">=</span> <span class="n">CustomDismissAnimationController</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>åŒæ—¶å®ç°ä¸‹é¢è¿™ä¸ªä»£ç†æ–¹æ³•ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">è¿”å›è´Ÿè´£è‡ªå®šä¹‰ Dismiss è½¬åœºåŠ¨ç”»å¯¹è±¡</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="k">func</span> <span class="n">animationControllerForDismissedController</span><span class="p">(</span><span class="nl">dismissed</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">UIViewControllerAnimatedTransitioning</span><span class="o">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">customDismissAnimationController</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>UIViewControllerTransitioningDelegate</code> åè®®æä¾›äº†ä¸Šé¢è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥è®¾ç½®è´Ÿè´£ dismiss è½¬åœºåŠ¨ç”»çš„æ§åˆ¶å™¨ã€‚</p>

<p>è¿è¡Œç¨‹åºï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„åŠ¨ç”»ã€‚</p>

<p><img src="http://i1.tietuku.com/b42fc6619b716079.gif" alt="" /></p>

<p>æ˜¾ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„åŠ¨ç”»ã€‚from view çš„æ¶ˆå¤±åŠ¨ç”»æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œä½†æ˜¯å›¾ç‰‡ image çš„ç›¸å¯¹ä½ç½®æ²¡æœ‰å˜åŒ–ã€‚è¿™æ˜¯å› ä¸ºï¼Œæˆ‘ä»¬æ”¹å˜çš„æ˜¯ from view çš„ frameï¼Œè¿™å¹¶ä¸ä¼šå½±å“åˆ°å®ƒçš„å­è§†å›¾ã€‚æˆ‘ä»¬å°†ç”¨ UIView çš„å¿«ç…§ <code>snapshot</code> æ¥ä¿®å¤è¿™ä¸ª bugã€‚</p>

<p>UIView å¿«ç…§æ˜¯å¯¹å½“å‰å­˜åœ¨çš„ UIView æˆªå›¾è®©å®ƒæˆä¸ºä¸€ä¸ªè½»é‡çº§çš„ UIViewï¼Œæˆ‘ä»¬å°†åœ¨åŠ¨ç”»ä¸­ä½¿ç”¨å¿«ç…§è€Œä¸æ˜¯çœŸæ­£çš„ viewã€‚</p>

<p>ä¿®æ”¹ <code>animateTransition()</code> å‡½æ•°å†…éƒ¨å¦‚ä¸‹ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">animateTransition</span><span class="p">(</span><span class="nl">transitionContext</span><span class="p">:</span> <span class="bp">UIViewControllerContextTransitioning</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">fromViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">viewControllerForKey</span><span class="p">(</span><span class="n">UITransitionContextFromViewControllerKey</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">toViewController</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">viewControllerForKey</span><span class="p">(</span><span class="n">UITransitionContextToViewControllerKey</span><span class="p">)</span><span class="o">!</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">finalFrameForVC</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">finalFrameForViewController</span><span class="p">(</span><span class="n">toViewController</span><span class="p">)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">containerView</span> <span class="o">=</span> <span class="n">transitionContext</span><span class="p">.</span><span class="n">containerView</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// è®¾ç½® toVC çš„æ ¹ view çš„ frame ä»¥åŠé€æ˜åº¦</span>
</span><span class='line'>    <span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">finalFrameForVC</span>
</span><span class='line'>    <span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
</span><span class='line'>    <span class="c1">// å°†ç›®æ ‡æ§åˆ¶å™¨çš„æ ¹ view æ·»åŠ è‡³å®¹å™¨è§†å›¾ containerView</span>
</span><span class='line'>    <span class="n">containerView</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">)</span>
</span><span class='line'>    <span class="n">containerView</span><span class="p">.</span><span class="n">sendSubviewToBack</span><span class="p">(</span><span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ç”Ÿæˆå¿«ç…§ å¹¶æ·»åŠ åˆ°å®¹å™¨è§†å›¾</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">snapshotView</span> <span class="o">=</span> <span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">snapshotViewAfterScreenUpdates</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span>
</span><span class='line'>    <span class="n">snapshotView</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span>
</span><span class='line'>    <span class="n">containerView</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">snapshotView</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ç§»é™¤ fromVC çš„æ ¹ view</span>
</span><span class='line'>    <span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">removeFromSuperview</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// è®¾ç½®åŠ¨ç”»ä»£ç </span>
</span><span class='line'>    <span class="bp">UIView</span><span class="p">.</span><span class="n">animateWithDuration</span><span class="p">(</span><span class="n">transitionDuration</span><span class="p">(</span><span class="n">transitionContext</span><span class="p">),</span> <span class="nl">animations</span><span class="p">:</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">snapshotView</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectInset</span><span class="p">(</span><span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fromViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</span><span class='line'>        <span class="n">toViewController</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">})</span> <span class="p">{</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Void</span> <span class="k">in</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// åŠ¨ç”»ç»“æŸå é€šçŸ¥è½¬åœºä¸Šä¸‹æ–‡è½¬åœºç»“æŸ å¹¶ç§»é™¤å¿«ç…§</span>
</span><span class='line'>        <span class="n">snapshotView</span><span class="p">.</span><span class="n">removeFromSuperview</span><span class="p">()</span>
</span><span class='line'>        <span class="n">transitionContext</span><span class="p">.</span><span class="n">completeTransition</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª fromVC çš„æ ¹ view çš„å¿«ç…§ï¼Œæ·»åŠ åˆ°å®¹å™¨è§†å›¾ï¼Œå¹¶ç§»é™¤ fromVC çš„æ ¹ viewã€‚è½¬åœºåŠ¨ç”»ä¸­ç¼©æ”¾å¿«ç…§ï¼ŒåŠ¨ç”»å®Œæˆåå°†å¿«ç…§ä»å®¹å™¨è§†å›¾ä¸­ç§»é™¤ã€‚</p>

<p>è¿è¡Œç¨‹åºï¼Œè½¬åœºåŠ¨ç”»ä¸€åˆ‡æ­£å¸¸ã€‚</p>

<p><img src="http://i1.tietuku.com/c7d1a6eb3c4a7645.gif" alt="" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[åœ¨Xcode6ä¸­ä½¿ç”¨IBDesignableåˆ›å»ºè‡ªå®šä¹‰æ§ä»¶(ç¿»è¯‘)]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/05/28/zai-xcode6zhong-shi-yong-ibdesignablechuang-jian-zi-ding-yi-kong-jian-fan-yi/"/>
    <updated>2015-05-28T00:16:31+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/05/28/zai-xcode6zhong-shi-yong-ibdesignablechuang-jian-zi-ding-yi-kong-jian-fan-yi</id>
    <content type="html"><![CDATA[<p><a href="http://www.appcoda.com/ibdesignable-ibinspectable-tutorial/">è‹±æ–‡åŸæ–‡åœ°å€</a></p>

<p>åœ¨Xcodeçš„æ—§ç‰ˆæœ¬ä¸­ï¼Œè¯•å›¾åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æ§ä»¶ï¼Œå¹¶ä¸æ˜¯å¾ˆå®¹æ˜“ï¼Œå› ä¸ºåœ¨IBä¸­ï¼Œå¹¶ä¸èƒ½å®æ—¶é¢„è§ˆåˆ°ä½ çš„è®¾è®¡æˆæœï¼Œåªèƒ½åœ¨æ¨¡æ‹Ÿå™¨ä¸­æµ‹è¯•ã€‚å¯¹äºè®¾è®¡ä¸€ä¸ªå•ä¸€ç»„ä»¶ï¼Œå¯èƒ½éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´ã€‚</p>

<p>Xcode6çš„å‘å¸ƒï¼Œè‹¹æœä¸ºå¼€å‘è€…æ„å»ºè‡ªå®šä¹‰æ§ä»¶æ¨å‡ºäº†æ–°åŠŸèƒ½<strong>IBDesignable</strong>å’Œ<strong>IBInspectable</strong>ï¼Œå…è®¸åœ¨IBä¸­å®æ—¶é¢„è§ˆè®¾è®¡æˆæœã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™ä¼šç»™æˆ‘ä»¬åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­æé«˜ä¸å°‘æ•ˆç‡ã€‚</p>

<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œå°†ä»‹ç»IBDesignable IBInspectableï¼Œä»¥åŠå±•ç¤ºå¦‚ä½•åˆ©ç”¨è¿™ä¸ªæ–°åŠŸèƒ½ã€‚é™¤è¿‡åˆ›å»ºdemoç¤ºä¾‹æ²¡æœ‰æ›´å¥½åœ°æ–¹å¼æ¥é˜è¿°è¿™ä¸€æ–°ç‰¹æ€§ï¼Œå› æ­¤ï¼Œåˆ›å»ºä¸€ä¸ª"Rainbow"è‡ªå®šä¹‰ç•Œé¢ã€‚</p>

<!--more-->


<p><img src="http://i1.tietuku.com/a476b2f40c2465d0.png" alt="æ•ˆæœå›¾" /></p>

<hr />

<h3>IBDesignableå’ŒIBInspectable</h3>

<p>ä½¿ç”¨IBDesignableå’ŒIBInspectableï¼Œå¼€å‘è€…åˆ›å»ºç•Œé¢(æˆ–è§†å›¾)å¯ä»¥å®æ—¶å‘ˆç°åœ¨IBä¸­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºäº†ä½¿ç”¨è¿™ä¸ªæ–°ç‰¹æ€§ï¼Œä½ éœ€è¦åšçš„æ˜¯åˆ›å»ºä¸€ä¸ª<code>UIView</code>æˆ–è€…<code>UIControl</code>çš„å­ç±»ï¼Œç„¶ååœ¨å®šä¹‰ç±»çš„å‰é¢åŠ ä¸Š<code>@IBDesignable</code>å…³é”®å­—ã€‚å¦‚æœæ˜¯OCï¼Œä½¿ç”¨<code>IB_DESIGNABLE</code>å®ã€‚ä¸‹é¢æ˜¯Swiftç¤ºä¾‹ä»£ç :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="p">@</span><span class="n">IBDesignable</span>
</span><span class='line'><span class="k">class</span> <span class="nl">Rainbow</span><span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨Xcodeæ—§ç‰ˆæœ¬ä¸­ï¼Œä½ å¯ä»¥åœ¨IBä¸­ç¼–è¾‘<code>User Defined Runtime Attributes</code>æ¥æ”¹å˜ä¸€ä¸ªå¯¹è±¡çš„å±æ€§(ä¾‹å¦‚:layer.cornerRadius)ï¼Œé—®é¢˜æ˜¯ä½ éœ€è¦ç¡®åˆ‡çŸ¥é“å±æ€§åã€‚<code>IBInspectable</code>åªéœ€è¦ä¸€æ­¥ï¼Œå¯¹ä¸€ä¸ªå¯è§†åŒ–ç±»çš„å±æ€§å‰é¢åŠ ä¸Š<code>IBInspectable</code>å…³é”®å­—å‰ç¼€ï¼Œè¯¥å±æ€§ä¼šåœ¨æš´éœ²åœ¨IBä¸­ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªæ›´æ”¹å±æ€§å€¼æ›´ç®€å•çš„æ–¹æ³•ã€‚</p>

<p><img src="http://i1.tietuku.com/93c53c69c11bffa1.png" alt="IBå±æ€§" /></p>

<p>ä½ å¦‚æœä½¿ç”¨Swiftå¼€å‘appï¼Œä½ éœ€è¦åšçš„åªæ˜¯åœ¨ä½ é€‰æ‹©çš„å±æ€§å‰é¢åŠ ä¸Š<code>@IBInspectable</code>å…³é”®å­—ï¼Œä¸‹é¢æ˜¯ä¸ªç¤ºä¾‹ä»£ç ç‰‡æ®µ:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="p">@</span><span class="n">IBInspectable</span> <span class="k">var</span> <span class="nl">firstColor</span><span class="p">:</span> <span class="bp">UIColor</span> <span class="o">=</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">blackColor</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>   <span class="c1">// å€¼æ”¹å˜æ—¶æ›´æ–°UI</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>åˆ›å»ºXcodeé¡¹ç›®</h3>

<p>åˆ›å»ºä¸€ä¸ªæ–°çš„Xcodeé¡¹ç›®ï¼Œé€‰æ‹©Single View Applicationæ¨¡æ¿ï¼Œèµ·åä¸º<em>RainbowDemo</em>ï¼Œåœ¨æ­¤é¡¹ç›®ä¸­ï¼Œå°†ä½¿ç”¨Swiftè¯­è¨€ï¼Œå› æ­¤ï¼Œåˆ›å»ºé¡¹ç›®æ—¶ä¸è¦å¿˜è®°å‹¾é€‰ã€‚</p>

<p>å®Œæˆåï¼Œé€‰æ‹©Main.storyboardæ–‡ä»¶ï¼Œè®¾ç½®View Controllerçš„æ ¹è§†å›¾Viewçš„èƒŒæ™¯é¢œè‰²Hex Colorå€¼ä¸º<code>38334C</code>(æˆ–è€…ä»»ä½•ä½ æƒ³è¦çš„é¢œè‰²)ã€‚ç„¶åä»å¯¹è±¡åº“ä¸­æ‹–ä¸€ä¸ªViewæ”¾è¿›View Controllerï¼Œè®¾ç½®å®ƒçš„å¤§å°Widthä¸º600ï¼ŒHeightä¸º434ï¼Œç„¶åæŠŠå®ƒæ”¾åœ¨æ ¹è§†å›¾çš„ä¸­å¿ƒï¼Œè®¾ç½®æ–°è§†å›¾Viewå’Œæ ¹è§†å›¾ç›¸åŒèƒŒæ™¯é¢œè‰²ã€‚</p>

<blockquote><p>æç¤ºï¼šå¦‚æœæƒ³æ”¹å˜RGBé¢œè‰²å€¼ï¼Œåªéœ€æ‰“å¼€è°ƒè‰²æ¿å’Œåˆ‡æ¢åˆ°æ»‘å—æ ‡ç­¾æ¥æ”¹å˜RGBå€¼</p></blockquote>

<p><img src="http://i1.tietuku.com/ae13d9f742d52315.gif" alt="è®¾ç½®èƒŒæ™¯é¢œè‰²" /></p>

<p>åœ¨Xcode6ä¸­ï¼Œä¸ºäº†é€‚é…å„ä¸ªiOSè®¾å¤‡ï¼Œä½ å¿…é¡»ä¸ºè§†å›¾Viewé…ç½®è‡ªåŠ¨å¸ƒå±€çº¦æŸã€‚å¯¹äºç®€å•çš„çº¦æŸï¼Œä½ å¯ä»¥åœ¨è‡ªåŠ¨å¸ƒå±€èœå•å•å‡»<strong>Issues</strong>é€‰é¡¹ï¼Œé€‰æ‹©<code>Add Missing Contraints</code>ï¼ŒXcodeå°†è‡ªåŠ¨ä¸ºViewæ·»åŠ å¸ƒå±€çº¦æŸã€‚</p>

<p><img src="http://i1.tietuku.com/7b993f7b47a011c2.gif" alt="æ·»åŠ çº¦æŸ" /></p>

<hr />

<h3>åˆ›å»ºè‡ªå®šä¹‰Viewç±»</h3>

<p>ç°åœ¨ï¼Œä½ å·²ç»åœ¨storyboardä¸­åˆ›å»ºäº†ä¸€ä¸ªViewï¼Œæ˜¯æ—¶å€™åˆ›å»ºè‡ªå®šä¹‰Viewç±»äº†ã€‚ä½¿ç”¨Cocoa Touch Classæ–‡ä»¶æ¨¡æ¿ï¼Œåˆ›å»ºè‡ªå®šä¹‰ç±»æ–‡ä»¶ï¼Œç»§æ‰¿è‡ªUIViewï¼Œèµ·åä¸º"Rainbow"ã€‚</p>

<p><img src="http://i1.tietuku.com/08e097c646676e6a.png" alt="åˆ›å»ºè‡ªå®šä¹‰Viewç±»" /></p>

<p>åœ¨è‡ªå®šä¹‰ç±»ä¸­æ’å…¥ä»¥ä¸‹ä»£ç :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">import</span> <span class="n">UIKit</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nl">Rainbow</span><span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
</span><span class='line'>    <span class="kr">override</span> <span class="k">init</span><span class="p">(</span><span class="nl">frame</span><span class="p">:</span> <span class="bp">CGRect</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">.</span><span class="k">init</span><span class="p">(</span><span class="nl">frame</span><span class="p">:</span> <span class="n">frame</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">required</span> <span class="k">init</span><span class="p">(</span><span class="n">coder</span> <span class="nl">aDecoder</span><span class="p">:</span> <span class="bp">NSCoder</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">.</span><span class="k">init</span><span class="p">(</span><span class="nl">coder</span><span class="p">:</span> <span class="n">aDecoder</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚å‰æ‰€è¿°ï¼Œè¿™ä¸ªå¯è§†åŒ–ç±»æ˜¯UIViewçš„å­ç±»ï¼Œè®©è‡ªå®šä¹‰ç±»å®æ—¶å‘ˆç°ï¼Œéœ€è¦<code>override</code>ä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•ã€‚ç„¶åï¼Œæ‰“å¼€è¾…åŠ©ç¼–è¾‘å™¨ï¼Œæ›´æ”¹æ–°æ‹–çš„Viewçš„è‡ªå®šä¹‰ç±»ä¸º<em>Rainbow</em>ç±»ã€‚</p>

<p><img src="http://i1.tietuku.com/5e41283a3fd5d23c.gif" alt="" /></p>

<hr />

<h3>å®ç°IBDesignableæ§åˆ¶</h3>

<p>ä¸ºäº†å®ç°å®æ—¶é¢„è§ˆï¼Œåœ¨è‡ªå®šä¹‰ç±»å‰é¢åŠ ä¸€ä¸ªå‰ç¼€<code>@IBDesignable</code>å…³é”®å­—</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="p">@</span><span class="n">IBDesignable</span>
</span><span class='line'><span class="k">class</span> <span class="nl">Rainbow</span><span class="p">:</span> <span class="bp">UIView</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™ä¸ªå…³é”®å­—ç¡®å®ç®€å•ï¼Œä½†æ˜¯è¿™ç®€å•åœ°å…³é”®å­—å°†ä½¿ä½ çš„å¼€å‘æ›´åŠ å®¹æ˜“ã€‚æ¥ä¸‹æ¥ï¼Œæ·»åŠ ä¸€äº›è®¾ç½®é¢œè‰²çš„å±æ€§ã€‚åœ¨Rainbowç±»ä¸­æ’å…¥ä»¥ä¸‹ä»£ç :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="p">@</span><span class="n">IBInspectable</span> <span class="k">var</span> <span class="nl">firstColor</span><span class="p">:</span> <span class="bp">UIColor</span> <span class="o">=</span> <span class="bp">UIColor</span><span class="p">(</span><span class="nl">red</span><span class="p">:</span> <span class="p">(</span><span class="mf">37.0</span><span class="o">/</span><span class="mf">255.0</span><span class="p">),</span> <span class="nl">green</span><span class="p">:</span> <span class="p">(</span><span class="mf">252.0</span><span class="o">/</span><span class="mi">255</span><span class="p">),</span> <span class="nl">blue</span><span class="p">:</span> <span class="p">(</span><span class="mf">244.0</span><span class="o">/</span><span class="mf">255.0</span><span class="p">),</span> <span class="nl">alpha</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span class='line'><span class="p">@</span><span class="n">IBInspectable</span> <span class="k">var</span> <span class="nl">secondColor</span><span class="p">:</span> <span class="bp">UIColor</span> <span class="o">=</span> <span class="bp">UIColor</span><span class="p">(</span><span class="nl">red</span><span class="p">:</span> <span class="p">(</span><span class="mf">171.0</span><span class="o">/</span><span class="mf">255.0</span><span class="p">),</span> <span class="nl">green</span><span class="p">:</span> <span class="p">(</span><span class="mf">250.0</span><span class="o">/</span><span class="mi">255</span><span class="p">),</span> <span class="nl">blue</span><span class="p">:</span> <span class="p">(</span><span class="mf">81.0</span><span class="o">/</span><span class="mf">255.0</span><span class="p">),</span> <span class="nl">alpha</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span class='line'><span class="p">@</span><span class="n">IBInspectable</span> <span class="k">var</span> <span class="nl">thirdColor</span><span class="p">:</span> <span class="bp">UIColor</span> <span class="o">=</span> <span class="bp">UIColor</span><span class="p">(</span><span class="nl">red</span><span class="p">:</span> <span class="p">(</span><span class="mf">238.0</span><span class="o">/</span><span class="mf">255.0</span><span class="p">),</span> <span class="nl">green</span><span class="p">:</span> <span class="p">(</span><span class="mf">32.0</span><span class="o">/</span><span class="mi">255</span><span class="p">),</span> <span class="nl">blue</span><span class="p">:</span> <span class="p">(</span><span class="mf">53.0</span><span class="o">/</span><span class="mf">255.0</span><span class="p">),</span> <span class="nl">alpha</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¢„å…ˆå®šä¹‰æ¯ä¸ªå±æ€§ä¸€ä¸ªé»˜è®¤é¢œè‰²ï¼Œæ¯æ¬¡ç”¨æˆ·æ›´æ”¹å®ƒä»¬çš„å€¼æ—¶ä¼šé‡ç»˜è§†å›¾ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªå±æ€§åŠ äº†ä¸€ä¸ª<code>@IBInspectable</code>å…³é”®å­—å‰ç¼€ï¼Œç°åœ¨å»IBçš„å±æ€§æ£€æŸ¥å™¨ï¼Œä½ å¯ä»¥ç›´è§‚åœ°å‘ç°è¿™äº›å±æ€§:</p>

<p><img src="http://i1.tietuku.com/49ce99f08cfba0ab.png" alt="IBä¸­çš„å±æ€§" /></p>

<p>å¾ˆé…·ï¼Œå¯¹å§ï¼ŸIBInspectableé€šè¿‡æŒ‡ç¤ºå±æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨é¢œè‰²é€‰æ‹©å™¨å¯è§†åŒ–åœ°ç¼–è¾‘å®ƒä»¬ã€‚</p>

<p>åœ¨Rainbowç±»ä¸­ï¼Œä¸ºäº†åœ¨å±å¹•ä¸Šç”»ä¸€ä¸ªåœ†ï¼Œæ’å…¥ä»¥ä¸‹ä»£ç :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">func</span> <span class="nf">addOval</span><span class="p">(</span><span class="nl">lineWidth</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span> <span class="nl">path</span><span class="p">:</span> <span class="n">CGPathRef</span><span class="p">,</span> <span class="nl">strokeStart</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span> <span class="nl">strokeEnd</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span> <span class="nl">strokeColor</span><span class="p">:</span> <span class="bp">UIColor</span><span class="p">,</span> <span class="nl">fillColor</span><span class="p">:</span> <span class="bp">UIColor</span><span class="p">,</span> <span class="nl">shadowRadius</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span> <span class="nl">shadowOpacity</span><span class="p">:</span> <span class="n">Float</span><span class="p">,</span> <span class="nl">shadowOffset</span><span class="p">:</span> <span class="bp">CGSize</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>   <span class="k">let</span> <span class="n">arc</span> <span class="o">=</span> <span class="bp">CAShapeLayer</span><span class="p">()</span>
</span><span class='line'>   <span class="n">arc</span><span class="p">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="n">lineWidth</span>
</span><span class='line'>   <span class="n">arc</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
</span><span class='line'>   <span class="n">arc</span><span class="p">.</span><span class="n">strokeStart</span> <span class="o">=</span> <span class="n">strokeStart</span>
</span><span class='line'>   <span class="n">arc</span><span class="p">.</span><span class="n">strokeEnd</span> <span class="o">=</span> <span class="n">strokeEnd</span>
</span><span class='line'>   <span class="n">arc</span><span class="p">.</span><span class="n">strokeColor</span> <span class="o">=</span> <span class="n">strokeColor</span><span class="p">.</span><span class="bp">CGColor</span>
</span><span class='line'>   <span class="n">arc</span><span class="p">.</span><span class="n">fillColor</span> <span class="o">=</span> <span class="n">fillColor</span><span class="p">.</span><span class="bp">CGColor</span>
</span><span class='line'>   <span class="n">arc</span><span class="p">.</span><span class="n">shadowRadius</span> <span class="o">=</span> <span class="n">shadowRadius</span>
</span><span class='line'>   <span class="n">arc</span><span class="p">.</span><span class="n">shadowOpacity</span> <span class="o">=</span> <span class="n">shadowOpacity</span>
</span><span class='line'>   <span class="n">arc</span><span class="p">.</span><span class="n">shadowOffset</span> <span class="o">=</span> <span class="n">shadowOffset</span>
</span><span class='line'>   <span class="n">layer</span><span class="p">.</span><span class="n">addSublayer</span><span class="p">(</span><span class="n">arc</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºäº†ä¿è¯ä»£ç çš„ç®€æ´å’Œå¯è¯»æ€§ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¾æ®æ–¹æ³•è°ƒç”¨è€…ä¼ å…¥å‚æ•°æ¥ç»˜åˆ¶ä¸€ä¸ªå®Œæ•´çš„åœ†æˆ–è€…åŠåœ†çš„å…¬å…±æ–¹æ³•ã€‚åˆ©ç”¨CAShapeLayerç±»å¯ä»¥å¾ˆç®€å•çš„ç”»ä¸€ä¸ªåœ†æˆ–åœ†å¼§ã€‚ä½ å¯ä»¥ä½¿ç”¨strokeStartå’ŒstrokeEndå±æ€§æ§åˆ¶æ¸²æŸ“çš„å¼€å§‹å’Œç»“æŸã€‚é€šè¿‡æ”¹å˜strokeEndçš„å€¼åœ¨0.0åˆ°1.0ä¹‹é—´ï¼Œä½ å¯ä»¥ç»˜åˆ¶ä¸€ä¸ªå®Œæ•´æˆ–è€…éƒ¨åˆ†çš„åœ†ã€‚å…¶ä½™çš„å±æ€§æ˜¯åªæ˜¯ç”¨äºè®¾ç½®æ¸²æŸ“é¢œè‰²ï¼Œé˜´å½±é¢œè‰²ç­‰ï¼Œåœ¨CAShaperLayerå®˜æ–¹æ–‡æ¡£ä¸­å¯ä»¥æŸ¥çœ‹æ›´è¯¦ç»†çš„æ‰€æœ‰å¯ç”¨å±æ€§ã€‚</p>

<p>æ¥ä¸‹æ¥ï¼Œæ·»åŠ ä»¥ä¸‹æ–¹æ³•:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="nf">drawRect</span><span class="p">(</span><span class="nl">rect</span><span class="p">:</span> <span class="bp">CGRect</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// æ·»åŠ åœ†å¼§</span>
</span><span class='line'>    <span class="n">addCircle</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="nl">capRadius</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nl">color</span><span class="p">:</span> <span class="n">firstColor</span><span class="p">)</span>
</span><span class='line'>    <span class="n">addCircle</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="nl">capRadius</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nl">color</span><span class="p">:</span> <span class="n">secondColor</span><span class="p">)</span>
</span><span class='line'>    <span class="n">addCircle</span><span class="p">(</span><span class="mi">215</span><span class="p">,</span> <span class="nl">capRadius</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nl">color</span><span class="p">:</span> <span class="n">thirdColor</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">func</span> <span class="nf">addCircle</span><span class="p">(</span><span class="nl">arcRadius</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span> <span class="nl">capRadius</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span> <span class="nl">color</span><span class="p">:</span> <span class="bp">UIColor</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">CGRectGetMidX</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">y</span> <span class="o">=</span> <span class="n">CGRectGetMidY</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// åº•éƒ¨åœ†å¼§</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">pathBottom</span> <span class="o">=</span> <span class="bp">UIBezierPath</span><span class="p">(</span><span class="nl">ovalInRect</span><span class="p">:</span> <span class="n">CGRectMake</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">arcRadius</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span>
</span><span class='line'>        <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">arcRadius</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span> <span class="n">arcRadius</span><span class="p">,</span> <span class="n">arcRadius</span><span class="p">)).</span><span class="bp">CGPath</span>
</span><span class='line'>    <span class="n">addOval</span><span class="p">(</span><span class="mf">20.0</span><span class="p">,</span> <span class="nl">path</span><span class="p">:</span> <span class="n">pathBottom</span><span class="p">,</span> <span class="nl">strokeStart</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">strokeEnd</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span class='line'>        <span class="nl">strokeColor</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="nl">fillColor</span><span class="p">:</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">clearColor</span><span class="p">(),</span>
</span><span class='line'>        <span class="nl">shadowRadius</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">shadowOpacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">shadowOffset</span><span class="p">:</span> <span class="n">CGSizeZero</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// ä¸­é—´åœ†å¼§</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">pathMiddle</span> <span class="o">=</span> <span class="bp">UIBezierPath</span><span class="p">(</span><span class="nl">ovalInRect</span><span class="p">:</span> <span class="n">CGRectMake</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">capRadius</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">arcRadius</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
</span><span class='line'>        <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">capRadius</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span> <span class="n">capRadius</span><span class="p">,</span> <span class="n">capRadius</span><span class="p">)).</span><span class="bp">CGPath</span>
</span><span class='line'>    <span class="n">addOval</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nl">path</span><span class="p">:</span> <span class="n">pathMiddle</span><span class="p">,</span> <span class="nl">strokeStart</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">strokeEnd</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span class='line'>        <span class="nl">strokeColor</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="nl">fillColor</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
</span><span class='line'>        <span class="nl">shadowRadius</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="nl">shadowOpacity</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nl">shadowOffset</span><span class="p">:</span> <span class="n">CGSizeZero</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// é¡¶éƒ¨åœ†å¼§</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">pathTop</span> <span class="o">=</span> <span class="bp">UIBezierPath</span><span class="p">(</span><span class="nl">ovalInRect</span><span class="p">:</span> <span class="n">CGRectMake</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">arcRadius</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span>
</span><span class='line'>        <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">arcRadius</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span> <span class="n">arcRadius</span><span class="p">,</span> <span class="n">arcRadius</span><span class="p">)).</span><span class="bp">CGPath</span>
</span><span class='line'>    <span class="n">addOval</span><span class="p">(</span><span class="mf">20.0</span><span class="p">,</span> <span class="nl">path</span><span class="p">:</span> <span class="n">pathTop</span><span class="p">,</span> <span class="nl">strokeStart</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nl">strokeEnd</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span class='line'>        <span class="nl">strokeColor</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="nl">fillColor</span><span class="p">:</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">clearColor</span><span class="p">(),</span>
</span><span class='line'>        <span class="nl">shadowRadius</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">shadowOpacity</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nl">shadowOffset</span><span class="p">:</span> <span class="n">CGSizeZero</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>drawRect:</code>æ–¹æ³•é»˜è®¤ä»€ä¹ˆä¹Ÿä¸åšï¼Œä¸ºäº†åœ¨è‡ªå®šä¹‰Viewä¸­ç”»åœ†ï¼Œæˆ‘ä»¬overrideæ­¤æ–¹æ³•æ¥å®ç°è‡ªå·±çš„ç»˜åˆ¶ä»£ç ã€‚<code>addCircle:</code>æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼šarcRadiusï¼ŒcapRadiuså’Œcolorã€‚arcRadiusæ˜¯åœ†å¼§çš„åŠå¾„ï¼ŒcapRadiusæ˜¯åœ†å¼§è¾¹ç¼˜åŠå¾„ã€‚</p>

<p><code>addCircle:</code>æ–¹æ³•åˆ©ç”¨UIBezierPathç”»åœ†å¼§çš„ç®€å•å·¥ä½œåŸç†:</p>

<ol>
<li>é¦–å…ˆï¼Œåœ¨åº•éƒ¨ç”»äº†ä¸ªåŠåœ†å¼§</li>
<li>æ¥ä¸‹æ¥ï¼Œåœ¨åœ†å¼§è¾¹ç¼˜ç”»äº†ä¸€ä¸ªå®Œæ•´çš„å°åœ†</li>
<li>æœ€åï¼Œç”»äº†å¦ä¸€åŠåœ†å¼§</li>
</ol>


<p>åœ¨<code>drawRect:</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†<code>addCircle:</code>æ–¹æ³•ä¸‰æ¬¡ï¼Œä¼ å…¥çš„å‚æ•°æŒ‡å®šåœ†å¼§è¯¥æ€æ ·ç”»ï¼š</p>

<p><img src="http://i1.tietuku.com/c5769f1b0ed47bd7.jpg" alt="ç”»åœ†å¼§åŸç†" /></p>

<p>åˆ©ç”¨IBInspectableå±æ€§ï¼Œä½ å¯ä»¥åœ¨IBä¸­è‡ªç”±æ”¹å˜æ¯ä¸ªåœ†å¼§çš„é¢œè‰²ï¼Œè€Œä¸éœ€è¦å†™ä»£ç :</p>

<p><img src="http://i1.tietuku.com/dac4b07c68953a6d.png" alt="" /></p>

<p>æ˜¾ç„¶ï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨<code>@IBInspectable</code>æš´éœ²<code>arcRadius</code>å±æ€§ï¼Œä¾¿å¯ä»¥åœ¨IBä¸­ä¿®æ”¹ç»˜åˆ¶åœ†å¼§åŠå¾„ã€‚</p>

<p><img src="http://i1.tietuku.com/79c3c33c22943103.jpg" alt="ä¿®æ”¹åŠå¾„" /></p>

<hr />

<h3>æ€»ç»“</h3>

<p>é€šè¿‡æœ¬æ•™ç¨‹åï¼Œä½ ç°åœ¨äº†è§£äº†åœ¨Xcode6ä¸­å¦‚ä½•åˆ©ç”¨IBDesignableå’ŒIBInspectableå®æ—¶é¢„è§ˆç•Œé¢ã€‚åˆ©ç”¨è¿™ä¸ªæ–°ç‰¹æ€§ï¼Œä½ å¯ä»¥æ›´é«˜æ•ˆåˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶ã€‚</p>

<p><a href="https://github.com/lengmolehongyan/RainbowDemo">RainbowDemoåœ°å€</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Swift åŸºç¡€è¯­æ³•å­¦ä¹ ]]></title>
    <link href="http://lengmolehongyan.github.io/blog/2015/05/26/swiftji-chu-yu-fa-xue-xi/"/>
    <updated>2015-05-26T22:12:42+08:00</updated>
    <id>http://lengmolehongyan.github.io/blog/2015/05/26/swiftji-chu-yu-fa-xue-xi</id>
    <content type="html"><![CDATA[<p>æ³¨ï¼šæ­¤æ–‡é€‚ç”¨ Swift1.2 ç‰ˆæœ¬ï¼</p>

<h2>å˜é‡å’Œå¸¸é‡</h2>

<ul>
<li><code>var</code><strong>å˜é‡</strong>ï¼Œå¯ä»¥ä¿®æ”¹çš„</li>
<li><code>let</code><strong>å¸¸é‡</strong>ï¼Œä¸€ç»å®šä¹‰ä¸èƒ½ä¿®æ”¹</li>
<li>åœ¨swiftå¼€å‘ä¸­ï¼Œé€šå¸¸å…ˆå®šä¹‰å¸¸é‡<code>let</code>ï¼Œåªæœ‰å¿…é¡»ä¿®æ”¹çš„æ—¶å€™ï¼Œå†æ”¹æˆ<code>var</code></li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// å®ä¾‹åŒ–ä¸€ä¸ªUIViewå¯¹è±¡ ä¿å­˜åœ¨å †ä¸­</span>
</span><span class='line'><span class="k">let</span> <span class="n">view</span> <span class="o">=</span> <span class="bp">UIView</span><span class="p">(</span><span class="nl">frame</span><span class="p">:</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
</span><span class='line'><span class="c1">// ä¿®æ”¹çš„æ˜¯viewçš„å±æ€§ å¹¶æ²¡æœ‰ä¿®æ”¹viewæœ¬èº«çš„åœ°å€</span>
</span><span class='line'><span class="n">view</span><span class="p">.</span><span class="n">backgroudColor</span> <span class="o">=</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">redColor</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>æ³¨æ„ç‚¹:

<ul>
<li>swiftæ˜¯ä¸€ä¸ªå¯¹å˜é‡ç±»å‹è¦æ±‚åŠå…¶ä¸¥æ ¼çš„è¯­è¨€</li>
<li>ä»»ä½•æ•°æ®ç±»å‹ä¹‹é—´ï¼Œéƒ½ä¸èƒ½éšå¼è½¬æ¢ï¼Œå¦‚æœè¦åœ¨ä¸åŒç±»å‹ä¹‹é—´è¿›è¡Œè®¡ç®—ï¼Œå¿…é¡»è½¬æ¢æ ¼å¼</li>
<li>æ•°æ®ç±»å‹çš„æ¨å¯¼æ˜¯åœ¨ç»™å˜é‡è®¾ç½®åˆå§‹å€¼çš„æ—¶å€™ï¼Œæ ¹æ®â€œå³è¾¹â€æ¥åˆ¤æ–­çš„</li>
<li>åœ¨çœŸæ­£åˆå§‹åŒ–çš„æ—¶å€™ï¼Œæ‰èƒ½å†³å®šå˜é‡çš„å‡†ç¡®ç±»å‹</li>
</ul>
</li>
<li>åœ¨å®šä¹‰å˜é‡çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šå˜é‡çš„ç±»å‹ï¼Œä¾¿äºåç»­çš„è®¡ç®—ä¸éœ€è¦è½¬æ¢</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="nl">a</span><span class="p">:</span> <span class="n">Double</span> <span class="o">=</span> <span class="mi">10</span>
</span><span class='line'><span class="k">let</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">10.5</span>
</span><span class='line'><span class="k">let</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span></code></pre></td></tr></table></div></figure>




<!--more-->


<h2>åˆ†æ”¯</h2>

<ul>
<li><code>if</code>åœ¨Cè¯­è¨€ä¸­æœ‰ä¸€ä¸ªç‰¹ç‚¹:éé›¶å³çœŸï¼Œåœ¨swiftä¸­ï¼Œæ²¡æœ‰éé›¶å³çœŸçš„æ¦‚å¿µï¼Œåªæœ‰<code>true/false</code>ï¼Œåœ¨ç¼–å†™åˆ†æ”¯è¯­å¥æ—¶ï¼Œå¿…é¡»å‡†ç¡®çš„æŒ‡å®šæ¡ä»¶çš„çœŸå‡ã€‚</li>
<li>æ ¼å¼:

<ul>
<li>æ¡ä»¶ä¸éœ€è¦æ‹¬å·</li>
<li>å¿…é¡»è¦æœ‰<code>{}</code></li>
</ul>
</li>
<li><code>convenience init?()</code>è¡¨ç¤ºä¸€ä¸ªå‡½æ•°æœªå¿…èƒ½å¤ŸçœŸçš„å®ä¾‹åŒ–å‡ºæ¥ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨swiftä¸­ï¼Œè¦æ±‚åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œå¿…é¡»è€ƒè™‘è¿™äº›é—®é¢˜ï¼Œèƒ½å¤Ÿå°½æ—©åœ°å‘ç°é—®é¢˜</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// ä½¿ç”¨ifåŒæ—¶è®¾ç½®æ•°å€¼</span>
</span><span class='line'><span class="k">if</span> <span class="k">let</span> <span class="n">url</span> <span class="o">=</span> <span class="bp">NSURL</span><span class="p">(</span><span class="nl">string</span><span class="p">:</span> <span class="s">&quot;http://www.baidu.com/s?word=he&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// ä»£ç æ‰§è¡Œåˆ°æ­¤ urlå°±ä¸€å®šæœ‰å€¼ æ‰€ä»¥ä¸éœ€è¦å†ä½¿ç”¨!</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">request</span> <span class="o">=</span> <span class="bp">NSURLRequest</span><span class="p">(</span><span class="nl">URL</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>å®é™…çš„åº”ç”¨æŠ€å·§:

<ul>
<li><code>?</code>è¡¨ç¤ºå¯ä»¥æœ‰å€¼ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰å€¼</li>
<li>æ‰“å°å¯é€‰é¡¹çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šè¾“å‡ºä¸€ä¸ª<code>Optional</code>ï¼Œæç¤ºå¼€å‘è€…ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰é¡¹ï¼Œè‹¹æœæŠŠåˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰å†…å®¹çš„å·¥ä½œäº¤ç»™äº†ç¨‹åºå‘˜</li>
<li><code>??</code>ç”¨æ¥å¿«é€Ÿåˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸º<code>nil</code>
<p></p></li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">var</span> <span class="nl">str</span><span class="p">:</span> <span class="bp">NSString</span>
</span><span class='line'><span class="n">str</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span>
</span><span class='line'><span class="k">let</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>
</span><span class='line'><span class="c1">// å­˜åœ¨çš„é£é™© å¦‚æœstræ²¡æœ‰è®¾ç½®åˆå§‹å€¼ ä¼šç›´æ¥å´©æºƒ</span>
</span><span class='line'><span class="c1">// let len = a + str!.length</span>
</span><span class='line'><span class="c1">// ?? ç”¨æ¥å¿«é€Ÿåˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºnil</span>
</span><span class='line'><span class="k">let</span> <span class="n">len2</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="p">(</span><span class="n">str</span><span class="o">?</span><span class="p">.</span><span class="n">length</span> <span class="o">??</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>å¾ªç¯</h2>

<ul>
<li>ä¼ ç»Ÿçš„å†™æ³•ï¼Œå’ŒCè¯­è¨€å‡ ä¹ä¸€æ ·ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦ä½¿ç”¨<code>var</code>è€Œä¸æ˜¯<code>let</code></li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">for</span> <span class="k">var</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>æ–¹ä¾¿å†™æ³•ï¼Œ<code>in</code>ç”¨æ¥æŒ‡å®šèŒƒå›´</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// èŒƒå›´0~9</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.</span><span class="o">&lt;</span><span class="mi">10</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// èŒƒå›´0~10</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.</span><span class="mf">.10</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>å¦‚æœéå†çš„æ—¶å€™ï¼Œå¯¹ç´¢å¼•ä¸‹æ ‡ä¸å…³æ³¨ï¼Œåœ¨swiftä¸­ï¼Œ<code>_</code>ä½¿ç”¨çš„éå¸¸å¹¿æ³›ï¼Œä¸»è¦ç”¨äºå¿½ç•¥</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.</span><span class="mf">.5</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>å­—ç¬¦ä¸²</h2>

<ul>
<li>åœ¨swiftä¸­ï¼Œ<strong>å­—ç¬¦ä¸²</strong>é»˜è®¤çš„ç±»å‹æ˜¯<code>String</code>ï¼Œè€Œä¸æ˜¯<code>NSString</code></li>
<li>swiftä¸­<code>String</code>æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œæ‰§è¡Œæ•ˆç‡æ›´é«˜ï¼Œæ”¯æŒå¿«é€Ÿéå†ã€‚<code>NSString</code>ç»§æ‰¿è‡ª<code>NSObject</code>ï¼Œæ˜¯ä¸€ä¸ªOCå¯¹è±¡ï¼Œä¸æ”¯æŒå¿«é€Ÿéå†</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&quot;Hello!&quot;</span>
</span><span class='line'><span class="c1">// å¯¹å­—ç¬¦ä¸²çš„å¿«é€Ÿéå†</span>
</span><span class='line'><span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="n">str</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">println</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>å­—ç¬¦ä¸²çš„æ‹¼æ¥</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">str1</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span>
</span><span class='line'><span class="k">let</span> <span class="n">str2</span> <span class="o">=</span> <span class="n">str1</span> <span class="o">+</span> <span class="s">&quot;World!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>æ ¼å¼å­—ç¬¦ä¸²</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="n">str</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="nl">format</span><span class="p">:</span> <span class="s">&quot;%02d:%02d:%02d&quot;</span><span class="p">,</span> <span class="nl">arguments</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>åœ¨swiftä¸­ï¼Œå¦‚æœè¦ç»“åˆ<code>range</code>ä¸€èµ·ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œå»ºè®®å…ˆè½¬æˆ<code>NSString</code>å†å¤„ç†</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">let</span> <span class="nl">str</span><span class="p">:</span> <span class="bp">NSString</span> <span class="o">=</span> <span class="s">&quot;Hello, world!&quot;</span>
</span><span class='line'><span class="k">let</span> <span class="n">subS</span> <span class="o">=</span> <span class="n">str</span><span class="p">.</span><span class="n">substringWithRange</span><span class="p">(</span><span class="n">NSMakeRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>æ•°ç»„</h2>

<ul>
<li>ä½¿ç”¨<code>[]</code>å®šä¹‰<strong>æ•°ç»„</strong>ï¼Œæ•°ç»„ç±»å‹ç”±ä¸­æ‹¬å·é‡Œé¢å…ƒç´ å†³å®š</li>
<li>OCä¸­æ•°ç»„åˆ†ä¸ºå¯å˜æ•°ç»„å’Œä¸å¯å˜æ•°ç»„ï¼Œswiftä¸­<code>let</code>æ˜¯ä¸å¯å˜çš„ï¼Œ<code>var</code>æ˜¯å¯å˜çš„ï¼Œä¸èƒ½å‘ä¸å¯å˜æ•°ç»„ä¸­è¿½åŠ å…ƒç´ </li>
<li>æ•°ç»„éå†:</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// æ•°ç»„éå†</span>
</span><span class='line'><span class="k">let</span> <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="s">&quot;no&quot;</span><span class="p">]</span>
</span><span class='line'><span class="k">for</span> <span class="n">str</span> <span class="k">in</span> <span class="n">array</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">println</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>å¯å˜æ•°ç»„æ·»åŠ å…ƒç´ </li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">var</span> <span class="n">arrayM</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;age&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">arrayM</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;no&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>å¦‚æœå®šä¹‰æ•°ç»„æ—¶ï¼ŒæŒ‡å®šçš„å¯¹è±¡ç±»å‹ä¸ä¸€è‡´ï¼Œå®šä¹‰çš„æ•°ç»„ç±»å‹æ˜¯<code>[NSObject]</code>ã€‚OCä¸­ï¼Œå¦‚æœè¦å‘æ•°ç»„ä¸­æ·»åŠ æ•°å­—ï¼Œéœ€è¦è½¬æ¢æˆ<code>NSNumber</code>ï¼Œswiftä¸­ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ </li>
<li>æ•°ç»„çš„å®šä¹‰å’Œåˆå§‹åŒ–</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// å®šä¹‰ä½†æ˜¯æ²¡æœ‰åˆå§‹åŒ–</span>
</span><span class='line'><span class="k">var</span> <span class="nl">arrayM</span><span class="p">:</span> <span class="p">[</span><span class="n">String</span><span class="p">]</span>
</span><span class='line'><span class="c1">// åˆå§‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¯å˜æ•°ç»„</span>
</span><span class='line'><span class="n">arrayM</span> <span class="o">=</span> <span class="p">[</span><span class="n">String</span><span class="p">]()</span>
</span><span class='line'><span class="n">arrayM</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>å­—å…¸</h2>

<ul>
<li>å®šä¹‰ä¸€ä¸ª<strong>å­—å…¸</strong>ï¼Œä»ç„¶ä½¿ç”¨<code>[]</code>ï¼Œåœ¨ç›®å‰çš„swiftç‰ˆæœ¬ä¸­ï¼Œå®šä¹‰å­—å…¸é€šå¸¸ä½¿ç”¨<code>[String: NSObject]</code>ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<code>key</code>çš„ç±»å‹æ˜¯å›ºå®šçš„</li>
<li><code>let</code>æ˜¯ä¸å¯å˜çš„ï¼Œ<code>var</code>æ˜¯å¯å˜çš„</li>
<li>å¦‚æœ<code>key</code>å·²ç»å­˜åœ¨ï¼Œåˆ©ç”¨è¿™ä¸ª<code>key</code>è®¾ç½®æ•°æ®æ—¶ï¼Œä¼šè¦†ç›–ä¹‹å‰çš„å€¼</li>
<li>å­—å…¸çš„ç‰¹æ€§:<code>key</code>æ˜¯ä¸å…è®¸é‡å¤çš„</li>
<li>å­—å…¸çš„éå†:</li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// å®šä¹‰å¹¶ä¸”å®ä¾‹åŒ–å­—å…¸</span>
</span><span class='line'><span class="k">var</span> <span class="n">dict1</span> <span class="o">=</span> <span class="p">[</span><span class="nl">String</span><span class="p">:</span> <span class="bp">NSObject</span><span class="p">]()</span>
</span><span class='line'><span class="n">dict1</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;zhangsan&quot;</span>
</span><span class='line'><span class="n">dict1</span><span class="p">[</span><span class="s">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
</span><span class='line'><span class="c1">// æ³¨æ„:k, vå¯ä»¥éšä¾¿å†™ï¼Œä½†æ˜¯ï¼Œå‰é¢æ˜¯keyï¼Œåé¢æ˜¯value</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="n">kk</span><span class="p">,</span> <span class="n">vv</span><span class="p">)</span> <span class="k">in</span> <span class="n">dict1</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="p">(</span><span class="s">&quot;\(kk), \(vv)&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>å‡½æ•°</h2>

<ul>
<li><strong>å‡½æ•°</strong>çš„å®šä¹‰æ ¼å¼:

<ul>
<li><code>func å‡½æ•°å(å‚æ•°åˆ—è¡¨) -&gt; è¿”å›å€¼ {// ä»£ç å®ç°}</code></li>
<li><code>-&gt;</code>æ˜¯swiftç‰¹æœ‰çš„ï¼Œè¡¨ç¤ºå‰é¢çš„æ‰§è¡Œç»“æœï¼Œè¾“å‡ºç»™åé¢çš„</li>
<li>å¼ºåˆ¶å¡«å†™å‚æ•°ï¼Œä½¿ç”¨<code>#</code>ï¼Œå¯ä»¥åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šè®©ä»£ç æç¤ºæ›´ç›´è§‚</li>
</ul>
</li>
<li>å¦‚æœæ²¡æœ‰è¿”å›å€¼<code>-&gt; è¿”å›å€¼</code>å¯ä»¥çœç•¥ï¼Œä¸‹é¢ä¸‰ç§æ–¹å¼ç­‰ä»·

<ul>
<li><code>-&gt; Void</code></li>
<li><code>-&gt; ()</code></li>
<li>å®Œå…¨å¿½ç•¥
<p></p></li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// å®šä¹‰å‡½æ•°</span>
</span><span class='line'><span class="k">func</span> <span class="n">sum</span><span class="p">(</span><span class="err">#</span><span class="nl">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="err">#</span><span class="nl">b</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// å‡½æ•°è°ƒç”¨</span>
</span><span class='line'><span class="n">sum</span><span class="p">(</span><span class="nl">a</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="nl">b</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>é—­åŒ…</h2>

<ul>
<li><strong>é—­åŒ…</strong>å’ŒOCä¸­çš„<code>block</code>ç±»ä¼¼ï¼Œä½†æ˜¯OCä¸­çš„<code>block</code>æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œswiftä¸­<strong>å‡½æ•°</strong>æ˜¯<strong>é—­åŒ…</strong>çš„ä¸€ä¸ªç‰¹ä¾‹</li>
<li>é—­åŒ…çš„ä½¿ç”¨ï¼Œå‡ ä¹å’ŒOCä¸­çš„<code>block</code>æ˜¯ä¸€æ ·çš„

<ul>
<li>æå‰å‡†å¤‡å¥½ä»£ç </li>
<li>åœ¨éœ€è¦çš„æ—¶å€™æ‰§è¡Œ</li>
</ul>
</li>
<li>é—­åŒ…çš„æ ¼å¼:

<ul>
<li><code>{ (å‚æ•°) -&gt; () in // å‡†å¤‡æ‰§è¡Œçš„ä»£ç å®ç° }</code></li>
<li><code>in</code>æ˜¯å®šä¹‰å’Œä»£ç å®ç°ä¹‹é—´çš„åˆ†éš”</li>
</ul>
</li>
<li>é—­åŒ…çš„ç®€å†™:

<ul>
<li>å¦‚æœé—­åŒ…æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥è¿›è¡Œç®€åŒ–</li>
<li>ç§°ä¸ºâ€œå°¾éšé—­åŒ…â€
<p></p></li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span><span class='line'>        <span class="n">demo</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nl">completion</span><span class="p">:</span> <span class="p">{(</span><span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">()</span> <span class="k">in</span>
</span><span class='line'>            <span class="n">println</span><span class="p">(</span><span class="s">&quot;å›è°ƒå\(str)&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">func</span> <span class="nf">demo</span><span class="p">(</span><span class="nl">a</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="nl">completion</span><span class="p">:(</span><span class="nl">str</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">println</span><span class="p">(</span><span class="s">&quot;å›è°ƒå‰\(a)&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="c1">// æ‰§è¡Œå›è°ƒ</span>
</span><span class='line'>        <span class="n">completion</span><span class="p">(</span><span class="nl">str</span><span class="p">:</span> <span class="s">&quot;\(a)&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// è¾“å‡ºå›è°ƒå‰10 å›è°ƒå10</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>é—­åŒ…çš„<strong>è¿”å›å€¼</strong></li>
</ul>


<p></p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="kr">override</span> <span class="k">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>   <span class="nb">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</span><span class='line'>   <span class="n">demo</span> <span class="p">{</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="k">in</span>
</span><span class='line'>       <span class="k">return</span> <span class="mi">20</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>   <span class="c1">// è¾“å‡ºè¡Œé«˜20</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">func</span> <span class="nf">demo</span><span class="p">(</span><span class="nl">rowH</span><span class="p">:()</span> <span class="o">-&gt;</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>   <span class="k">let</span> <span class="n">rowH</span> <span class="o">=</span> <span class="n">rowH</span><span class="p">()</span>
</span><span class='line'>   <span class="n">println</span><span class="p">(</span><span class="s">&quot;è¡Œé«˜\(rowH)&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>å®šä¹‰<strong>é—­åŒ…å±æ€§</strong>çš„æ—¶å€™ï¼Œæœ‰ä¸¤ç§é€‰æ‹©

<ul>
<li>ç›´æ¥è®¾ç½®åˆå§‹å€¼</li>
<li>è®¾ç½®ä¸€ä¸ªå¯é€‰é¡¹<code>?</code>
<p></p></li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="c1">// å®šä¹‰æ–¹å¼ è¡¨ç¤ºé—­åŒ…å¯ä»¥ä¸ºç©º</span>
</span><span class='line'><span class="k">var</span> <span class="nl">completion</span><span class="p">:</span> <span class="p">(()</span><span class="o">-&gt;</span><span class="p">())</span><span class="o">?</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>é—­åŒ…çš„<strong>å¾ªç¯å¼•ç”¨</strong>

<ul>
<li><code>block</code>ä¸­å‡ºç°<code>self</code>çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯ä»£ç å®‰å…¨ï¼Œåœ¨å®šä¹‰é—­åŒ…çš„æ—¶å€™ï¼Œéœ€è¦å¯¹å¤–éƒ¨å˜é‡è¿›è¡Œæ‹·è´</li>
<li>OCä¸­è§£å†³å¾ªç¯å¼•ç”¨çš„åŠæ³•<code>__weak typeof(self) weakSelf = self</code></li>
<li>åœ¨swiftä¸­ï¼Œå¦‚æœç›´æ¥è®¿é—®å±æ€§æ•°å€¼ï¼Œå¯ä»¥çœç•¥<code>self.</code></li>
<li>swiftä¸­é»˜è®¤éƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œå¦‚æœéœ€è¦å¼±å¼•ç”¨ï¼Œå¯ä»¥ä½¿ç”¨<code>weak</code>ä¿®é¥°ç¬¦å·</li>
<li>åœ¨é—­åŒ…ä¸­ï¼Œå¿…é¡»è¦æ˜ç¡®çš„ä½¿ç”¨<code>self</code>ï¼Œå› ä¸ºé—­åŒ…æ˜¯æå‰å‡†å¤‡çš„ä»£ç ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šæ‰§è¡Œ</li>
<li>åœ¨OCä¸­åˆ¤æ–­æ˜¯å¦æœ‰å¾ªç¯å¼•ç”¨ï¼Œä½¿ç”¨<code>-dealloc</code>æ–¹æ³•ï¼Œåœ¨swiftä¸­<code>deinit</code>å«åš<strong>ææ„å‡½æ•°</strong>ï¼Œå°±æ˜¯åœ¨å¯¹è±¡è¢«é‡Šæ”¾å‰æ‰§è¡Œï¼Œä¸OCä¸­çš„<code>-dealloc</code>æ–¹æ³•ç±»ä¼¼
<p></p></li>
</ul>
</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='swift'><span class='line'><span class="k">weak</span> <span class="k">var</span> <span class="n">weakSelf</span> <span class="o">=</span> <span class="nb">self</span>
</span><span class='line'><span class="n">demo4</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// ä½¿ç”¨?çš„å¥½å¤„ å°±æ˜¯ä¸€æ—¦ self è¢«é‡Šæ”¾ï¼Œå°±ä»€ä¹ˆä¹Ÿä¸åš</span>
</span><span class='line'>  <span class="n">weakSelf</span><span class="o">?</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">redColor</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
